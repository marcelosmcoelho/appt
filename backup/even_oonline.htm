<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/mc.js" />
	</script>

	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>


</head>

<body>

	<script type="text/javascript">
		window.onerror = function (message, url, lineNumber) {
			alert("Error: " + message + " in " + url + " at line " + lineNumber);
		}

	</script>

	<script type="text/javascript">

        // var id_prog_manut = getquerystring("ipm");
		// var dia_ev = getquerystring("dia_ev");
		// var mes_ev = getquerystring("mes_ev");
		// var ano_ev = getquerystring("ano_ev");

        var id_prog_manut = 1043
		var dia_ev = 26
		var mes_ev = 10
		var ano_ev = 2019
        
		var id_cliente;
		var id_empree = "";
		var data_de_hoje = new Date();
		var e_construtora;

		document.addEventListener("deviceready", onDeviceReady, false);

		function onDeviceReady() {

			pictureSource = navigator.camera.PictureSourceType;
			destinationType = navigator.camera.DestinationType;

			iniciar();
		}

		/////////////////////////////

		function tem_conexao() {

			if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
				alert('Sem conexão com internet. Favor se conectar.');
				return false;
			}
			else {
				return true;
			}

		}


		/////////////////////////////
		function iniciar() {

			var menu_sup = [
				'<form name="form_sup" action="" method="get">',
				'<div data-role="header" data-position="fixed" data-theme="a">',
				'<div class="ui-corner-all custom-corners">',
				'<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
				'<div align="center">',
				'<a href="#" onClick="volta_uni()"><button class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-carat-l">Voltar</button></a>',
				'<table width="30"  border="0" cellpadding="0" cellspacing="0" >',
				'<tr>',
				'<td width="30" ><img src="images/logoSC.gif" width="112" height="35"> </td>',
				'</tr>',
				'</table>',
				'</div>',
				'</div>',
				'</div>',
				'</div>',
				'</form>'
			].join('');


			document.getElementById('menu_opc2').innerHTML = menu_sup;

			var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it				

			db.transaction(function (tx) {
				tx.executeSql('SELECT * FROM mtab_cliente', [], function (tx, results) {
					var len = results.rows.length;
					var row = results.rows.item(0);
					id_cliente = row['id_cliente'];
					e_construtora = row['e_construtora'];

					var nome_empree = "";
					db.transaction(function (tx) {
						tx.executeSql('SELECT * FROM mtab_empree', [], function (tx, results) {
							var len = results.rows.length;
							var i;
							for (i = 0; i < len; i++) {
								var row = results.rows.item(i)
								nome_empree = row['nome_empree']
								id_empree = row['id_empree']
								document.getElementById('nome_emp').innerHTML = nome_empree;
							}

							db.transaction(function (tx) {
								tx.executeSql('SELECT * FROM mtab_prog_manut WHERE mtab_prog_manut.id_prog_manut="' + id_prog_manut + '" ', [], function (tx, results) {
									var len = results.rows.length;
									var i;
									for (i = 0; i < len; i++) {
										var row = results.rows.item(i)
										var nome_sistema = row['nome_sistema']
										var nome_atividade = row['nome_atividade']
									}

									db.transaction(function (tx) {
										tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
											var len = results.rows.length;
											var i;
											var meio_empree = "";
											var final_empree = "";
											var tam_ti;
											var aux_image_upload;

											if (len == 0) {
												var rrr_caminho_imagens = ""
												var rrr_caminho_texto = ""
												var rrr_caminho_audio = ""
												var rrr_caminho_video = ""
												var rrr_id_prog_manut = id_prog_manut
												var rrr_status_caminho_imagens = ""
												var rrr_status_caminho_video = ""
												var rrr_status_caminho_audio = ""
												var rrr_status_caminho_texto = ""
											}
											else {
												var row = results.rows.item(0)
												var rrr_caminho_imagens = row['caminho_imagens'];
												var rrr_caminho_texto = row['caminho_texto'];
												var rrr_caminho_audio = row['caminho_audio'];
												var rrr_caminho_video = row['caminho_video'];
												var rrr_id_prog_manut = row['id_prog_manut']
												var rrr_status_caminho_imagens = row['status_imagens_upl']
												var rrr_status_caminho_video = row['status_video_upl']
												var rrr_status_caminho_audio = row['status_audio_upl']
												var rrr_status_caminho_texto = row['status_texto_upl']
											}

											var todas_imagens = ""
											var todas_status_imagens = ""
											if (rrr_caminho_imagens == null || rrr_caminho_imagens == "") {
												tam_ti = 0;
											}
											else {
												todas_imagens = rrr_caminho_imagens.split("**")
												todas_status_imagens = rrr_status_caminho_imagens.split("**")
												tam_ti = todas_imagens.length;
											}

											var selec_imagens_thumb = ""
											var selec_imagens = ""

											for (k = 0; k < tam_ti; k++) {

												if (todas_status_imagens[k] == '0') {
													aux_image_upload = "upload1.gif";
												}
												else {
													aux_image_upload = "upload2.gif";
												}
												//imagens da seta, preta ou verde

												selec_imagens_thumb = selec_imagens_thumb + "<div style='float:left;'><table cellpadding='0' cellspacing='0'><tr><td colspan='2'><img src='" + todas_imagens[k] + "'  onclick='abrir_popup(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + "," + String.fromCharCode(34) + k + String.fromCharCode(34) + " )'  width='106' height='70' hspace='2' vspace='2'/> </td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'/></div></td></tr></table></div>"
												selec_imagens = selec_imagens + "<div data-role='popup' id='idpopup_" + rrr_id_prog_manut + "_" + k + "'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right'>Close</a> <img class='popphoto' src='" + todas_imagens[k] + "' style='max-height:512px;'> </div>"

												//Poup
											}


											if (rrr_status_caminho_audio == '0') {
												aux_image_upload = "upload1.gif";
											}
											else {
												aux_image_upload = "upload2.gif";
											}
											//se ta preta ou verde do áduio

											var selec_audio;
											if (rrr_caminho_audio == "") {
												selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><tr><td colspan='2'><img id='latesq_" + rrr_id_prog_manut + "' src='images/player_latesq.gif'  width='40' height='30' style='display:none'/><img id='player_" + rrr_id_prog_manut + "' src='images/player_play.gif'  onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  width='40' height='30' style='display:none'/><img id='pause_" + rrr_id_prog_manut + "' src='images/player_pause.gif'  onclick='pause_audio()'  width='40' height='30' style='display:none'/><img id='stop_" + rrr_id_prog_manut + "' src='images/player_stop.gif'  onclick='stop_audio()'  width='40' height='30' style='display:none'/><img id='rec_" + rrr_id_prog_manut + "' src='images/player_rec.gif'  onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'  width='40' height='30' style='display:none'/><img id='latdir_" + rrr_id_prog_manut + "'  src='images/player_latdir.gif'  width='40' height='30' style='display:none'/></td></tr><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()'  style='display:none'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()' style='display:none'/></div></td></tr></table></div>"
											}
											else {
												selec_audio = "<div><table cellpadding='0' cellspacing='0'><tr><td height='15' colspan='2'></td></tr><tr><td colspan='2'><img id='latesq_" + rrr_id_prog_manut + "' src='images/player_latesq.gif'  width='40' height='30' /><img id='player_" + rrr_id_prog_manut + "' src='images/player_play.gif'  onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  width='40' height='30'/><img id='pause_" + rrr_id_prog_manut + "' src='images/player_pause.gif'  onclick='pause_audio()'  width='40' height='30' /><img id='stop_" + rrr_id_prog_manut + "' src='images/player_stop.gif'  onclick='stop_audio()'  width='40' height='30'/><img id='rec_" + rrr_id_prog_manut + "' src='images/player_rec.gif'  onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'  width='40' height='30' /><img id='latdir_" + rrr_id_prog_manut + "' src='images/player_latdir.gif'  width='40' height='30' /></td></tr><tr><td height='13' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_audio()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_audio()'/></div></td></tr></table></div>"
											}
											//barra do áudio


											if (rrr_status_caminho_video == '0') {
												aux_image_upload = "upload1.gif";
											}
											else {
												aux_image_upload = "upload2.gif";
											}
											//setinha do vídeo

											var selec_video;
											if (rrr_caminho_video == "") {
												selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:none'><table cellpadding='0' cellspacing='0'><tr><td height='12' colspan='2'></td></tr><tr><td colspan='2'><video id='qvideo_" + rrr_id_prog_manut + "' controls width='230' height='230'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video></td></tr><tr><td height='3' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_video()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_video()'/></div></td></tr></table></div>"
											}
											else {
												selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:inline'><table cellpadding='0' cellspacing='0'><tr><td height='12' colspan='2'></td></tr><tr><td colspan='2'><video id='qvideo_" + rrr_id_prog_manut + "' controls width='230' height='230'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video></td></tr><tr><td height='3' colspan='2'></td></tr><tr><td><div align='center'><img src='images/trash.gif' width='25' height='25' onclick='deletar_video()'/></div></td><td><div align='center'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_video()'/></div></td></tr></table></div>"
											}
											//barrinha do vídeo



											if (rrr_status_caminho_texto == '0') {
												aux_image_upload = "upload1.gif";
											}
											else {
												aux_image_upload = "upload2.gif";
											}
											//seta do texto

											var selec_texto;
											selec_texto = rrr_caminho_texto;

											var bot_up
											if (rrr_caminho_texto == "") {
												bot_up = "<div style='display:none'><img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_texto()'/></div>"
											}
											else {
												bot_up = "<img src='images/" + aux_image_upload + "' width='25' height='25' onclick='upload_texto()'/>"
											}



											var item_opc = [
												'<div align="center">',
												'<br>',
												'<table width="90%" height="30" border="1" cellpadding="0" cellspacing="0" bordercolor="">',
												'<tr>',
												'<td height="30" bgcolor="#E5E5E5"  > <div align="center">' + nome_sistema + '</div>',
												'<div align="center" ></div></td>',
												'</tr>',
												'</table>',
												'<table width="90%" height="30" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
												'<tr>',
												'<td width="90%" bgcolor="#FFFFFF" >',
												'<div align="left" class="menu_3">' + nome_atividade + '</div></td>',
												'</tr>',
												'</table>',



												'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
												'<tr>',
												'<td width="50" height="40">',
												'<div align="center"><img src="images/photo.gif" onclick="getPhoto(pictureSource.CAMERA,' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
												'</td>',
												'<td width="10"></td>',
												'<td width="220" style="float:left"> <img id="foto_' + rrr_id_prog_manut + '" src=""  onclick="abrir_popup_new(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"  width="106" height="70" hspace="2" vspace="2"  style="display:none"/>   <div data-role="popup" id="idpopup_new_' + rrr_id_prog_manut + '"> <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a> <img id="foto_big_' + rrr_id_prog_manut + '"  class="popphoto" src="" style="max-height:512px;"> </div> ' + selec_imagens_thumb + selec_imagens + '</td>',
												'</tr>',
												'</table>',


												'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
												'<tr>',
												'<td width="50" height="40">',
												'<div align="center"><img src="images/video.gif" onclick="captureVideo(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
												'</td>',
												'<td width="10"></td>',
												'<td width="220" style="float:left">' + selec_video + '</td>',
												'</tr>',
												'</table>',



												'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
												'<tr>',
												'<td width="50" height="40">',
												'<div align="center"><img src="images/audio.gif" onclick="captureAudio(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></div>',
												'</td>',
												'<td width="10"></td>',
												'<td width="220" style="float:left">' + selec_audio + '</td>',
												'</tr>',
												'</table>',




												'<table width="90%" height="40" border="1" cellpadding="0" cellspacing="0" bordercolor="#DCDCDC">',
												'<tr>',
												'<td width="50" height="40">',
												'<div align="center"><img src="images/texto.gif"  width="38" height="28" ></div>',
												'</td>',
												'<td width="10"></td>',
												'<td width="220" style="float:left">',
												'<div class="ui-field-contain"><textarea style="width:97%" rows="4"  id="textarea_' + rrr_id_prog_manut + '" maxlength="700">' + selec_texto + '</textarea></div>',
												'<table width="200" height="35" border="0" cellpadding="0" cellspacing="0" >',
												'<tr>',
												'<td width="200" ><div align="center">',
												'<img src="images/but_save.gif"  width="73" height="27" onclick="atualizar_texto(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" style="cursor:pointer">',
												'</div></td>',
												'<td width="100"><div align="center">' + bot_up + '</div></td>',
												'</tr>',
												'</table>',
												'</td>',
												'</tr>',
												'</table>',

												'<br>',
												'</div>'
											].join('');

											//toda a ba contendo a descrição, imagens, videos, audio e texto								

											document.getElementById('vistoria').innerHTML = item_opc;


											///////////////////  Acionar .popup para imagens iniciarem escondidas  //////////////
											tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
												var len2 = results.rows.length;
												var i2;
												var tam_ti2;

												if (len2 == 0) {
													var rrr2_caminho_imagens = ""
													var rrr2_id_prog_manut = id_prog_manut
												}
												else {
													var row2 = results.rows.item(0)

													var rrr2_caminho_imagens = row2['caminho_imagens'];
													var rrr2_id_prog_manut = row2['id_prog_manut']
												}


												var todas_imagens2 = ""
												var tam_ti2
												if (rrr2_caminho_imagens == null || rrr2_caminho_imagens == "") {
													tam_ti2 = 0;
												}
												else {
													todas_imagens2 = rrr2_caminho_imagens.split("**")
													tam_ti2 = todas_imagens2.length;
												}


												for (k = 0; k < tam_ti2; k++) {
													$("#idpopup_" + rrr2_id_prog_manut + "_" + k).popup();
												}

												$("#idpopup_new_" + rrr2_id_prog_manut).popup();

											}, null);
											/////////////////// FIM - Acionar .popup para imagens iniciarem escondidas  //////////////


										}, null);
									});
								}, null);
							});

						}, null);
					});

				}, null);
			});

		}

	</script>

	<a name="ancora123"></a>

    <span id="menu_opc2"></span>

	<div align="center">
		<table border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td>
					<div align="center"><span id="nome_emp"></span></div>
				</td>
			</tr>
		</table>
	</div>

	<div id="parte_load" align="center" style="display:none">
		<table width="224" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td width="42" height="49">
					<div align="center"><img src="images/loader_blue.gif" width="35" height="35"></div>
				</td>
				<td width="182"><strong>
						<font color="#990000">AGUARDE O ENVIO...</font>
					</strong></td>
			</tr>
		</table>
	</div>

	<span id="vistoria"></span>
	<br><br><br><br><br><br><br><br><br><br><br><br><br><br>

</body>

</html>

<script>

	function abrir_popup(id1, id2) {
		var id1;
		var id2;

		$("#idpopup_" + id1 + "_" + id2).popup();
		$("#idpopup_" + id1 + "_" + id2).popup('open');
	}

	function abrir_popup_new(id) {
		var id;
		$("#idpopup_new_" + id).popup();
		$("#idpopup_new_" + id).popup('open');
	}


	var qual_id_prog_manut

	//////////////////////  ini para  texto   /////////////////////////////
	function atualizar_texto(qual) {
		var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
		var quale;

		qual_id_prog_manut = qual;
		quale = document.getElementById('textarea_' + qual).value;

		var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db2.transaction(function (tx) {

			tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
				var len2 = results.rows.length;

				if (len2 == 0) {
					tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_texto,caminho_video,caminho_audio, caminho_imagens, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","","","","0")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, quale]);
				}
				else {
					var row = results.rows.item(0)
					tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_texto="' + quale + '" , status_texto_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
				}

				reload_page();

			}, null);

		});


	}
	//////////////////////  fim  texto   /////////////////////////////


	///////////////////////////////////ini para a camera //////////////////////
	var aux_caminho_imagens = ""
	var aux_status_imagens_upl = ""

	function getPhoto(source, qual) {

		qual_id_prog_manut = qual;

		var r = confirm("clique aqui");
		if (r == true) {
			source = pictureSource.CAMERA;
		} else {
			source = pictureSource.PHOTOLIBRARY;
		}

		navigator.camera.getPicture(onPhotoURISuccess, onFail, {
			quality: 50,
			destinationType: destinationType.FILE_URI,
			encodingType: Camera.EncodingType.JPEG,
			popoverOptions: CameraPopoverOptions,
			//	saveToPhotoAlbum: true,
			sourceType: source
		});

	}

	function onFail(message) {
		alert('Failed because: ' + message);
	}

	// Cordova


	function onPhotoURISuccess(imageURI) {
		document.getElementById('foto_' + qual_id_prog_manut).src = imageURI;
		document.getElementById('foto_' + qual_id_prog_manut).style.display = "inline";

		document.getElementById('foto_big_' + qual_id_prog_manut).src = imageURI;

		var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db2.transaction(function (tx) {

			tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
				var len = results.rows.length;
				var i;

				if (len == 0) {
					aux_caminho_imagens = ""
					tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_imagens,caminho_audio, caminho_video, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","0","","","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, imageURI]);
				}
				else {
					var row = results.rows.item(0)
					aux_caminho_imagens = row['caminho_imagens'];
					aux_caminho_imagens = aux_caminho_imagens + '**';

					aux_status_imagens_upl = row['status_imagens_upl'];
					aux_status_imagens_upl = aux_status_imagens_upl + '**';
					aux_status_imagens_upl = aux_status_imagens_upl + '0';


					tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_imagens="' + aux_caminho_imagens + imageURI + '" , status_imagens_upl="' + aux_status_imagens_upl + '" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
				}

				reload_page();
				// terminou de tirar a foto, aqui é a seleção da seta

			}, null);

		});

	}


	//// deletar imagem ///////////////
	function deletar_imagem(q_id) {
		var q_id;
		var all_images;
		var all_status_images;
		var taman;
		var aux_1 = "";
		var aux_1_status = "";

		var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db.transaction(function (tx) {

			tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
				var k;

				var row = results.rows.item(0)
				aux_caminho_imagens = row['caminho_imagens'];
				aux_status_imagens_upl = row['status_imagens_upl'];

				all_images = aux_caminho_imagens.split("**")
				all_status_images = aux_status_imagens_upl.split("**")
				taman = all_images.length;

				for (k = 0; k < taman; k++) {
					if (q_id != k) {
						aux_1 = aux_1 + all_images[k] + "**"
						aux_1_status = aux_1_status + all_status_images[k] + "**"
					}
				}
				var aux_2 = aux_1.substring(0, aux_1.length - 2)
				var aux_2_status = aux_1_status.substring(0, aux_1_status.length - 2)

				tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_imagens="' + aux_2 + '" , status_imagens_upl="' + aux_2_status + '"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

				reload_page();

			}, null);
		});

	}
	/////////  fim  deletar imagem///////

	/////// upload imagem  //////////////////////



	var aux_1_status = "";

	function upload_imagem(q_id) {

		if (tem_conexao()) {

			var q_id;
			var all_images;
			var all_status_images;
			var taman;
			var aux_1 = "";

			var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
					var k;

					var row = results.rows.item(0)
					aux_caminho_imagens = row['caminho_imagens'];

					all_images = aux_caminho_imagens.split("**")

					aux_1 = aux_1 + all_images[q_id] + "**"
					var aux_2 = aux_1.substring(0, aux_1.length - 2)

					// marcar que foi feito upload para esta imagem

					aux_status_imagens_upl = row['status_imagens_upl'];

					all_status_images = aux_status_imagens_upl.split("**");
					taman = all_status_images.length;

					for (k = 0; k < taman; k++) {
						if (q_id != k) {
							aux_1_status = aux_1_status + all_status_images[k] + "**"
						}
						else {
							aux_1_status = aux_1_status + "1" + "**"
							var ja_fez_upload = all_status_images[k]
						}
					}

					aux_1_status = aux_1_status.substring(0, aux_1_status.length - 2)
					// fim  marcar que foi feito upload para esta imagem
					if (ja_fez_upload != '1') {


						up_loadPhoto(aux_2, q_id, aux_1_status);
					}
					else {


						up_loadPhoto(aux_2, q_id, aux_status_imagens_upl);
					}

				}, null);
			});

		}
	}

	function up_loadPhoto(imageURI, q_k) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var q_k;
		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
		options.mimeType = "image/jpeg";

		var params = new Object();
		params.value1 = "test";
		params.value2 = "param";

		options.params = params;
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(imageURI, "http://www.newdot.com.br/phonegap/app_sc/rec_foto_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente + "&q_k=" + q_k, win_up, fail_up, options);

	}

	var win_up = function (r) {

		var db3 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
		db3.transaction(function (tx) {

			tx.executeSql('UPDATE mtab_prog_manut_evento SET status_imagens_upl="' + aux_1_status + '" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

			reload_page();

		});

	}

	var fail_up = function (error) {
		alert(" Houve uma falha ao carregar a imagem. Erro: " + error.code);
	}
	////////// fim upload imagem /////////

	///////////////////////////////////////fim para a camera //////////////////////


	////////////////////////////////////////// INICIO VIDEO  //////////////
	function captureVideo(qual) {
		qual_id_prog_manut = qual;
		navigator.device.capture.captureVideo(videocaptureSuccess, videocaptureError, { limit: 1, duration: 15 });
	}


	function videocaptureSuccess(mediaFiles) {
		var i, len;
		var m_path;


		for (i = 0, len = mediaFiles.length; i < len; i += 1) {
			m_path = mediaFiles[i].fullPath;

			document.getElementById('video_invis_' + qual_id_prog_manut).style.display = "inline";

			var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db2.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
					var len2 = results.rows.length;

					if (len2 == 0) {
						tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_video,caminho_imagens,caminho_audio, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","","0","","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, m_path]);
					}
					else {
						var row = results.rows.item(0)
						tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_video="' + m_path + '" , status_video_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
					}

					reload_page();

				}, null);

			});

		}
	}

	function videocaptureError(error) {
		var msg = 'An error occurred during capture: ' + error.code;
		alert(msg);
	}


	//// deletar video ///////////////
	function deletar_video() {

		var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db.transaction(function (tx) {

			tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_video="" , status_video_upl="0"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
			reload_page();
		});

	}
	/////////  fim  deletar video///////

	/////// upload video  //////////////////////
	function upload_video() {

		if (tem_conexao()) {


			var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

					var row = results.rows.item(0)

					if (row['status_video_upl'] != '1') {
						var aux_caminho_video = row['caminho_video'];
						//tx.executeSql('UPDATE mtab_prog_manut_evento SET status_video_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
						up_loadVideo(aux_caminho_video);
					}
					else {
						var aux_caminho_video = row['caminho_video'];
						up_loadVideo(aux_caminho_video);
					}

				}, null);
			});

		}
	}


	function up_loadVideo(videoURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = videoURL.substr(videoURL.lastIndexOf('/') + 1);
		options.mimeType = "video/mp4";
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(videoURL, "http://www.newdot.com.br/phonegap/app_sc/rec_video_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente, win_up_v, fail_up_v, options);

	}


	var win_up_v = function (r) {
		var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db.transaction(function (tx) {
			tx.executeSql('UPDATE mtab_prog_manut_evento SET status_video_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

			reload_page();
			alert("Vídeo upado com sucesso");

		});
	}

	var fail_up_v = function (error) {
		alert("An error has occurred: Code = " + error.code);
		alert("Erro ao upar o vídeo")
	}
	/////// fim upload video  //////////////////////

	////////////////////////////////////////// FIM VIDEO  //////////////

	///////////////////////////////////////// INICIO para Audio ////////////////
	var myMedia3 = null;
	var esta_pausado = 0;

	function captureAudio(qual) {
		qual_id_prog_manut = qual;
		navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
	}

	function captureSuccess(mediaFiles) {
		var i, len;
		var m_path;

		for (i = 0, len = mediaFiles.length; i < len; i += 1) {
			m_path = mediaFiles[i].fullPath;

			if ((m_path.substring(0, 6) == "file:/") && (m_path.substring(6, 7) != "/")) {
				m_path = m_path.replace("file:/", "file:///");
			}
			else {
				m_path = m_path;
			}

			document.getElementById('player_' + qual_id_prog_manut).onclick = function () {
				abrir_audio(m_path);
			};
			document.getElementById('latesq_' + qual_id_prog_manut).style.display = "inline";
			document.getElementById('player_' + qual_id_prog_manut).style.display = "inline";
			document.getElementById('pause_' + qual_id_prog_manut).style.display = "inline";
			document.getElementById('stop_' + qual_id_prog_manut).style.display = "inline";
			document.getElementById('rec_' + qual_id_prog_manut).style.display = "inline";
			document.getElementById('latdir_' + qual_id_prog_manut).style.display = "inline";

			var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db2.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
					var len2 = results.rows.length;

					if (len2 == 0) {
						tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_video,caminho_imagens,caminho_audio, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,"","",?,"","","","0","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, m_path]);
					}
					else {
						var row = results.rows.item(0)
						tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_audio="' + m_path + '" , status_audio_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
					}

					reload_page();

				}, null);

			});

		}
	}

	function captureError(error) {
		var msg = 'An error occurred during capture: ' + error.code;
		alert(msg);
	}



	function abrir_audio(qual) {
		if (esta_pausado == 0) {
			myMedia3 = new Media(qual);
			myMedia3.play();
		}
		if (esta_pausado == 1) {
			myMedia3.play();
			esta_pausado = 0;
		}

	}

	function pause_audio() {
		if (myMedia3) {
			myMedia3.pause();
			esta_pausado = 1;
		}
	}

	function stop_audio() {
		if (myMedia3) {
			myMedia3.stop();
			esta_pausado = 0;
		}
	}

	//// deletar audio ///////////////
	function deletar_audio() {

		var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db.transaction(function (tx) {

			tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_audio="" , status_audio_upl="0"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
			reload_page();
		});

	}
	/////////  fim  deletar audio///////

	/////// upload audio  //////////////////////
	function upload_audio() {

		if (tem_conexao()) {

			var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

					var row = results.rows.item(0)

					if (row['status_audio_upl'] != '1') {
						var aux_caminho_audio = row['caminho_audio'];
						//tx.executeSql('UPDATE mtab_prog_manut_evento SET status_audio_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
						up_loadAudio(aux_caminho_audio);
					}
					else {
						var aux_caminho_audio = row['caminho_audio'];
						up_loadAudio(aux_caminho_audio);
					}


				}, null);
			});

		}
	}


	function up_loadAudio(audioURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var options = new FileUploadOptions();
		options.fileKey = "file";
		options.fileName = audioURL.substr(audioURL.lastIndexOf('/') + 1);
		options.mimeType = "audio/amr";
		options.chunkedMode = false;

		var ft = new FileTransfer();
		ft.upload(audioURL, "http://www.newdot.com.br/phonegap/app_sc/rec_audio_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente, win_up_a, fail_up_a, options);

	}



	var win_up_a = function (r) {
		var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
		db.transaction(function (tx) {
			tx.executeSql('UPDATE mtab_prog_manut_evento SET status_audio_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

			reload_page();

		});
	}

	var fail_up_a = function (error) {
		alert("An error has occurred: Code = " + error.code);
	}
	/////// fim upload audio  //////////////////////

	/////// upload texto  //////////////////////
	function upload_texto() {

		if (tem_conexao()) {

			var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
			db.transaction(function (tx) {

				tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

					var row = results.rows.item(0)

					if (row['status_texto_upl'] != '1') {
						var aux_caminho_texto = row['caminho_texto'];
						//tx.executeSql('UPDATE mtab_prog_manut_evento SET status_texto_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
						up_loadTexto(aux_caminho_texto);
					}
					else {
						var aux_caminho_texto = row['caminho_texto'];
						up_loadTexto(aux_caminho_texto);
					}


				}, null);
			});

		}
	}


	function up_loadTexto(textoURL) {

		document.getElementById("parte_load").style.display = "block";
		window.location.href = "#ancora123"

		var data = 'tx=' + encodeURIComponent(textoURL) + '&ipm=' + id_prog_manut + '&d=' + dia_ev + '&m=' + mes_ev + '&a=' + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente;
		var ajax = new XMLHttpRequest();
		ajax.open("POST", "http://www.newdot.com.br/phonegap/app_sc/rec_texto_uploaded.asp", true);
		ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		ajax.onreadystatechange = function () {
			if (ajax.readyState == 4) {//Request complete !!
				if (ajax.status == 200 || ajax.status == 0) { // OK response

					var resposta_total = ajax.responseText;
					if (resposta_total == "grav_ok") {
						var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
						db.transaction(function (tx) {
							tx.executeSql('UPDATE mtab_prog_manut_evento SET status_texto_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
							reload_page(); // adicionar aqui a estrutura para certiifcar que foi upado
							alert("Texto upado com suceddo");

						});
					}
					else {
						alert("Problemas com a gravação do texto. Tentar novamente.");
					}

				}
				else {
					alert("Problemas com sua conexao internet. Erro: 01");
				}
			}

		}

		data = data.split(":").join("%3A")
		data = data.split("{").join("%7B")
		data = data.split("}").join("%7D")
		data = data.split(",").join("%2C")
		data = data.split("[").join("%5B")
		data = data.split("]").join("%5D")
		data = data.split(String.fromCharCode(34)).join("%22")

		ajax.send(data);

	}

	/////// fim upload texto  //////////////////////

	///////////////////////////////////////// FIM para Audio

	function reload_page() {
		window.location.assign("even.htm?ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
	}

	function volta_uni() {

		if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
			alert('Está offline');
			window.location.assign("empree.htm?e=" + id_empree)
		}
		else {
			alert('Está onlline');
			window.location.assign("onlline.html");
		}


	}

</script>