<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/custom.css" />
    <link rel="stylesheet" href="css/custom-mobile.css" />
    <link rel="stylesheet" href="css/custom-even.css" />
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
    <title>Even_onlline</title>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="js/mc.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://kit.fontawesome.com/c202879e33.js" crossorigin="anonymous"></script>
    <style>
        .menu .ui-mini.ui-btn-icon-left:after,
        .ui-mini .ui-btn-icon-left:after,
        .ui-header .ui-btn-icon-left:after,
        .ui-footer .ui-btn-icon-left:after {
            display: none;
        }

        .ui-btn-icon-left {
            position: relative;
            padding-left: 12px !important;
            bottom: 8px;
        }

        .ui-icon-minus {
            width: 123px !important;
        }

        .ui-icon-plus {
            width: 14px !important;
        }

        .ui-collapsible-inset .ui-collapsible-heading .ui-btn {
            box-shadow: none !important;
        }
    </style>

    <script>
        // VARIÁVEIS ACESSADAS VIA QUERY.PARAMS
        var login = getquerystring("l");
        var senha = getquerystring("s");

        var id_prog_manut = getquerystring("ipm");
        var dia_ev = getquerystring("dia_ev");
        var mes_ev = getquerystring("mes_ev");
        var ano_ev = getquerystring("ano_ev");
        var d_min = getquerystring("d_min");
        var d_max = getquerystring("d_max");
        var tipo = getquerystring("tipo");

        var input_data_realiz = getquerystring("input_data_realiz");
        var input_forn = getquerystring("input_forn");
        var input_custoReal = getquerystring("input_custoReal");
        var input_custoEstim = getquerystring("input_custoEstim");
        var input_obsCondo = getquerystring("input_obsCondo");
        var input_obsConstr = getquerystring("input_obsConstr");

        var id_cliente;
        var id_empree = "";
        var nome_sistema = ""
        var data_de_hoje = new Date();
        var e_construtora = "";
        var nivel_manut;
        var qt_docs;
        var qt_docs_constr;

        var qtdDocs_Device = 0
        var ev_email = 0

        var apagar1;

        // FUNÇÃO QUE APRESENTA O ERRO NA APLICAÇÃO
        window.onerror = function (message, url, lineNumber) {
            alert(`Error: ${message} in ${url} at line ${lineNumber}`);
        }

        // INICIALIZA O PROCESSAMENTO DA APLICAÇÃO
        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {

            pictureSource = navigator.camera.PictureSourceType;
            destinationType = navigator.camera.DestinationType;
            mediaType = navigator.camera.MediaType;

            if (tem_conexao()) {
                iniciar()
            } else {
                window.location.assign("even.htm?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
            }
        }

        // EXECUTA CASO TENHA INTERNET
        function iniciar() {

            var rrr_id_prog_manut = id_prog_manut

            // CASCA OFFLINE
            var menu_sup_offline = [
                '<form name="form_sup" action="" method="get">',
                '<div data-role="header" data-position="fixed" data-theme="a">',
                '<div class="ui-corner-all custom-corners">',
                '<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
				'<div class="barra1" align="left"><img src="images/wifi_vermelho.png" style="position: absolute; left: 70px; top: 20px;" width="17" /></div>',
                '<div align="center">',
                '<a href="#"><button style="box-shadow: none !important; background: #ebebeb !important; border: none;" onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-carat-l">Voltar</button></a>',
                '<table width="30" border="0" cellpadding="0" cellspacing="0" >',
                '<tr>',
                '<td width="30" ><img src="images/logo4.png" width="142"> </td>',
                '</tr>',
                '</table>',
                '</div>',
                '</div>',
                '</div>',
                '</div>',
                '</form>'
            ].join('');

            // CASCA ONLINE
            var menu_sup_online = [
                '<form name="form_sup" action="" method="get">',
                '<div data-role="header" data-position="fixed" data-theme="a">',
                '<div class="ui-corner-all custom-corners">',
                '<div class="ui-bar ui-bar-a" style="height:38;text-align:center">',
				'<div class="barra1" align="left"><img src="images/wifi_verde.png" style="position: absolute; left: 70px; top: 20px;" width="17" /></div>',
                '<div align="center">',
                '<a href="#"><button style="box-shadow: none !important; background: #ebebeb !important; border: none;" onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-carat-l">Voltar</button></a>',
                '<table width="30" border="0" cellpadding="0" cellspacing="0" >',
                '<tr>',
                '<td width="30" ><img src="images/logo4.png" width="142"> </td>',
                '</tr>',
                '</table>',
                '</div>',
                '</div>',
                '</div>',
                '</div>',
                '</form>'
            ].join('');

            document.getElementById('menu_opc2').innerHTML = menu_sup_online;

            // FUNÇÃO QUE VERIFICA SE TEM INTERNET A CADA 5 SEGUNDOS
            setInterval(function () {
                if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
                    document.getElementById('menu_opc2').innerHTML = menu_sup_offline;
                    return false;
                } else {
                    document.getElementById('menu_opc2').innerHTML = menu_sup_online;
                    return true;
                }
            }, 5000);

            // CAPTURANDO DADOS DO EVENTO
            var ajax2 = new XMLHttpRequest();
            ajax2.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_dados_evento_online.asp?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&versao=2.0&t=" + Math.random(), false);
            ajax2.onreadystatechange = function () {
                if (ajax2.readyState == 4) { //Request complete !!
                    if (ajax2.status == 200 || ajax2.status == 0) { // OK response

                        var resposta_total = ajax2.responseText;
                        var jsontext = resposta_total.split("#")

                        var getLogin = JSON.parse(jsontext[0]);
                        var logou = getLogin.logou;

                        if (logou == "S") {

                            // DADOS COLETADOS DA REQUISIÇÃO
                            id_cliente = getLogin.id_cliente;
                            e_construtora = getLogin.e_construtora;
                            var nome_empree = getLogin.nome_empree;
                            id_empree = getLogin.id_empree;
                            nome_sistema = getLogin.nome_sistema;
                            var nome_atividade = getLogin.nome_atividade;
                            var aux_data = getLogin.aux_data;
                            var periodicidade = getLogin.periodicidade;
                            var nome_emp_resp = getLogin.nome_emp_resp;
                            var data_manut_realizada = getLogin.data_manut_realizada;
                            var custo_estimado = getLogin.custo_estimado;
                            var custo_real = getLogin.custo_real;
                            nivel_manut = getLogin.nivel_manut;
                            qt_docs = getLogin.qt_docs;
                            qt_docs_constr = getLogin.qt_docs_constr;
                            var fornecedor = getLogin.fornecedor;
                            var observacao_evento = getLogin.observacao_evento;
                            var observacao_evento_construtora = getLogin.observacao_evento_construtora;
                            var id_ajuda_docs = getLogin.id_ajuda_docs;

                            var getCaminhos = jsontext[1];
                            var objCaminhos = JSON.parse(getCaminhos);

                            var trecho_imagens_constr_imagens = "";
                            var trecho_imagens_constr_videos = "";
                            var trecho_imagens_constr_audios = "";
                            var trecho_imagens_constr_textos = "";

                            var dados_popup_img = "";

                            var trecho_imagens_cond_imagens = "";
                            var trecho_imagens_cond_videos = "";
                            var trecho_imagens_cond_audios = "";
                            var trecho_imagens_cond_textos = "";
                            var dados_manutencao = "";
                            var dados_documentos = "";
                            var dados_observacao = "";
                            var dados_ajuda_docs = "";

                            var texto_total;
                            var variavelx = "";
                            var variavelx2 = "";

                            // CONDIÇÃO QUE VERIFICA SE TEM ALGUM DOCUMENTO DO CONDOMÍNIO DENTRO DA GALERIA DE IMAGENS SERVIDOR
                            if (qt_docs == 0) {
                                document.getElementById('condominio_content').innerHTML = [
                                    '<div class="ui-body ui-body-a">',
                                    '<h4 class="margin">',
                                    '<strong class="is-red">Galeria condomínio vazia</strong>',
                                    '</h4>',
                                    '<div id="imagens_bco"></div>',
                                    '<div id="videos_bco"></div>',
                                    '<div id="audios_bco"></div>',
                                    '<div id="textos_bco"></div>',
                                    '</div>'
                                ].join('')
                            }

                            // CONDIÇÃO QUE VERIFICA SE TEM ALGUM DOCUMENTO DA CONSTRUTORA DENTRO DA GALERIA DE IMAGENS SERVIDOR
                            if (qt_docs_constr == 0) {
                                document.getElementById('construtora_content').innerHTML = [
                                    '<div class="ui-body ui-body-a">',
                                    '<h4 class="margin">',
                                    '<strong class="is-red">Galeria construtora vazia</strong>',
                                    '</h4>',
                                    '<div id="imagens_bco_constr"></div>',
                                    '<div id="videos_bco_constr"></div>',
                                    '<div id="audios_bco_constr"></div>',
                                    '<div id="textos_bco_constr"></div>',
                                    '</div>'
                                ].join('')
                            }

                            // VERIFICA A ORIGEM E TIPO DO ARQUIVO
                            for (i = 0; i < objCaminhos.cam_arquivos.length; i++) {

                                if (objCaminhos.cam_arquivos[i].ori == 'd' && e_construtora == '0') {
                                    if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                        trecho_imagens_cond_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                        dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                        variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                        variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                        trecho_imagens_cond_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                        trecho_imagens_cond_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" ></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 19px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                        texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                        trecho_imagens_cond_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 15px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + texto_total[0] + String.fromCharCode(39) + ')"></button></div>'
                                    }
                                } else if (objCaminhos.cam_arquivos[i].ori == 'd' && e_construtora == '1') {
                                    if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                        trecho_imagens_cond_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                        dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                        variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                        variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                        trecho_imagens_cond_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                        trecho_imagens_cond_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" ></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                        texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                        trecho_imagens_cond_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    }
                                } else if (objCaminhos.cam_arquivos[i].ori == 's' && e_construtora == '1') {
                                    if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                        trecho_imagens_constr_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                        dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                        variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                        variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                        trecho_imagens_constr_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 22px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                        trecho_imagens_constr_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" ></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 19px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + objCaminhos.cam_arquivos[i].cam + String.fromCharCode(39) + ')"></button></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                        texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                        trecho_imagens_constr_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div><button style="background-color: transparent; float: right; position: relative; right: 10px; bottom: 15px; border: none; outline: none;" type="button"><img src="images/trash.png" style="float: right; position: relative;" class="all_trash" width="14" onclick="apagar_fot_vid_aud_tex(' + String.fromCharCode(39) + texto_total[0] + String.fromCharCode(39) + ')"></button></div>'
                                    }
                                } else if (objCaminhos.cam_arquivos[i].ori == 's' && e_construtora == '0') {
                                    if (objCaminhos.cam_arquivos[i].ta == 'i') {
                                        trecho_imagens_constr_imagens += '<div style="display: inline-block;"><button style="background: transparent; border: none;"><img src="' + objCaminhos.cam_arquivos[i].cam + '" class="imagem_popup popphoto" onclick="abrir_popup_gal(' + i + ')" alt="" width="100" height="75"></button><div style="color: #6A2628; font-size: 11px; width: 80%; text-align: left; position: relative; left: 5px;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                        dados_popup_img += '<div style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.8);" onclick="fechar_popup_gal(' + i + ')" id="popup_fundo_' + i + '"></div><div style="width: 80%; height: 80%; background: rgba(0,0,0,.5); margin: 0 auto; position: relative; top: 60px; border-radius: 8px;" id="idpopup_img_' + i + '"><a style="bottom:10px" href="#" onclick="fechar_popup_gal(' + i + ')" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a><img class="popphoto" src="' + objCaminhos.cam_arquivos[i].cam + '" onclick="fechar_popup_gal(' + i + ')" style="height: 80%; width: 100%; border-radius: 8px;"></div>'
                                        variavelx += '$("#idpopup_img_' + i + '").css({  display: "none"  });'
                                        variavelx2 += '$("#popup_fundo_' + i + '").css({  display: "none"  });'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'v') {
                                        trecho_imagens_constr_videos += '<div style="display: inline-block;"><video class="imagem_popup" poster="images/video.png" width="120" height="120" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" type="video/mp4"></video><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 'a') {
                                        trecho_imagens_constr_audios += '<div><audio style="margin-bottom: 10px; width: 100%;" controls><source src="' + objCaminhos.cam_arquivos[i].cam + '" ></audio><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    } else if (objCaminhos.cam_arquivos[i].ta == 't') {
                                        texto_total = objCaminhos.cam_arquivos[i].cam.split('*$*')
                                        trecho_imagens_constr_textos += '<div><textarea style="width: 100%; background: #e7e7e7; resize: none" class="imagem_popup" rows="4" cols="30" readonly="readonly">' + texto_total[1] + '</textarea><div style="color: #6A2628; font-size: 11px; width: 60%; text-align: left;">' + objCaminhos.cam_arquivos[i].data + '</div></div>'
                                    }
                                }
                            }

                            var ini_lista = "<ul id='q_empree' class='list-content' data-mini='true' data-role='listview' data-filter='true' data-filter-placeholder='Buscar...' data-inset='true'>";
                            var fim_lista = "</ul>";

                            var seleciona1 = ""
                            var seleciona2 = ""
                            var seleciona3 = ""

                            var aux_data_preench;
                            var aux_custoReal_preench;
                            var aux_custoEstim_preench;
                            var aux_obsCondo_preench;
                            var aux_obsConstr_preench;

                            if (input_data_realiz == "") {
                                aux_data_preench = dateToEN2(data_manut_realizada)
                            } else {
                                aux_data_preench = input_data_realiz
                            }

                            if (input_forn == "") {
                                if (fornecedor == "Equipe Local") {
                                    seleciona1 = "selected"
                                }
                                if (fornecedor == "Empresa Capacitada") {
                                    seleciona2 = "selected"
                                }
                                if (fornecedor == "Empresa Especializada") {
                                    seleciona3 = "selected"
                                }
                            } else {
                                if (input_forn == "1") {
                                    seleciona1 = "selected"
                                }
                                if (input_forn == "2") {
                                    seleciona2 = "selected"
                                }
                                if (input_forn == "3") {
                                    seleciona3 = "selected"
                                }
                            }

                            if (input_custoReal == "") {
                                aux_custoReal_preench = custo_real
                            } else {
                                aux_custoReal_preench = input_custoReal
                            }

                            if (input_custoEstim == "") {
                                aux_custoEstim_preench = custo_estimado
                            } else {
                                aux_custoEstim_preench = input_custoEstim
                            }

                            if (e_construtora == '0') {
                                dados_manutencao = [
                                    '<li class="shadow_box">',
                                    '<div class="text-center-title">',
                                    '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                    '</div>',
                                    '<div class="text-center-paragraph">',
                                    '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                    '</div>',
                                    '<div class="mensalmente-paragraph">',
                                    '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                    '</div>',
                                    '<div class="data_periodicidade_paragraph">',
                                    '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                    '</div>',
                                    '</li>',

                                    '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                    '<div class="ui-grid-a">',
                                    '<div class="ui-block-a">',
                                    '<tbody>',
                                    '<tr>',
                                    '<th style="padding: 0">',
                                    '<div class="input-responsive">',
                                    '<label for="">Data realização:</label>',
                                    '<input style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao" type="date" onkeypress="mascara(this, sonumeros_data)" id="in_data_realizacao" required="" value="' + aux_data_preench + '" />',
                                    '</div>',
                                    '</th>',
                                    '</tr>',
                                    '</tbody>',
                                    '</div>',
                                    '<div style="position: relative;" class="ui-block-b">',
                                    '<label for="">Empresa:</label>',
                                    '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">',
                                    '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                    '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                    '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                    '</select>',
                                    '</div>',
                                    '</div>',
                                    '<table>',
                                    '<div class="ui-grid-a">',
                                    '<div class="ui-block-a custo-estimado">',
                                    '<label for="">Custo estimado:</label>',
                                    '<input style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeypress="mascara(this, sonumeros_decimais)" placeholder="Custo estimado" value="' + aux_custoEstim_preench + '" />',
                                    '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                    '</div>',
                                    '<div class="ui-block-b custo-real">',
                                    '<label for="">Custo real:</label>',
                                    '<input style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeypress="mascara(this, sonumeros_decimais)" placeholder="Custo real" value="' + aux_custoReal_preench + '" />',
                                    '<img src="images/money-bill-alt-verde.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                    '</div>',
                                    '</div>',
                                    '</table>',
                                    '</li>'
                                ].join('');
                            } else {

                                dados_manutencao = [
                                    '<li class="shadow_box">',
                                    '<div class="text-center-title">',
                                    '<font style="font-weight: bold; text-shadow: none;" id="atividade_title" size="4" face="Arial">' + nome_sistema + '</font>',
                                    '</div>',
                                    '<div class="text-center-paragraph">',
                                    '<p id="atividade_content" class="text-size-content" size="2" face="Arial" color="#0000FF">' + nome_atividade + '</p>',
                                    '</div>',
                                    '<div class="mensalmente-paragraph">',
                                    '<strong class="mensalmente">' + periodicidade + '</strong> - <span>' + nome_emp_resp + '</span>',
                                    '</div>',
                                    '<div class="data_periodicidade_paragraph">',
                                    '<font class="atividade_title" size="3" face="Arial">' + dateToEN(aux_data) + '</font>',
                                    '</div>',
                                    '</li>',

                                    '<li class="shadow_box box__content__funcoes" style="border-radius: 0;">',
                                    '<div class="ui-grid-a">',
                                    '<div class="ui-block-a">',
                                    '<tbody>',
                                    '<tr>',
                                    '<th style="padding: 0">',
                                    '<div class="input-responsive">',
                                    '<label for="">Data realização:</label>',
                                    '<input style="height: 36px; width: 100%; border-radius: 4px; text-align: left; background: rgba(200,0,0,.5); color: #fff !important; text-shadow: none !important; font-weight: normal !important; font-size: 13px !important;" placeholder="Data realização" class="textbox-n date-size text-date data_formato ui-btn ui-icon-calendar ui-btn-icon-right data_realizacao" type="date" onkeypress="mascara(this, sonumeros_data)" id="in_data_realizacao" disabled="" required="" value="' + aux_data_preench + '" />',
                                    '</div>',
                                    '</th>',
                                    '</tr>',
                                    '</tbody>',
                                    '</div>',
                                    '<div style="position: relative;" class="ui-block-b">',
                                    '<label for="">Empresa:</label>',
                                    '<select style="height: 35px; background: #f6f6f6; border-color: #dddddd; font-size: 13px; outline: none; width: 100%; border-radius: 4px; padding-left: 5px;" id="valores" name="select-native-2" data-mini="true" onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" disabled="">',
                                    '<option class="size_option" value="1" ' + seleciona1 + '>Equipe Local</option>',
                                    '<option class="size_option" value="2" ' + seleciona2 + '>Empresa Capacitada</option>',
                                    '<option class="size_option" value="3" ' + seleciona3 + '>Empresa Especializada</option>',
                                    '</select>',
                                    '</div>',
                                    '</div>',
                                    '<table>',
                                    '<div class="ui-grid-a">',
                                    '<div class="ui-block-a custo-estimado">',
                                    '<label for="">Custo estimado:</label>',
                                    '<input style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-estimado-input" type="tel" name="text-basic" id="in_dado_custo_estimado" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeypress="mascara(this, sonumeros_decimais)" placeholder="Custo estimado" disabled="" value="' + aux_custoEstim_preench + '" />',
                                    '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                    '</div>',
                                    '<div class="ui-block-b custo-real">',
                                    '<label for="">Custo real:</label>',
                                    '<input style="height: 35px; background: #f6f6f6; border: 1px solid #dddddd; text-shadow: none; font-size: 13px; outline: none; width: 100%; padding-right: 35px; border-radius: 4px; padding-left: 5px;" class="custo-real-input" type="tel" name="text-basic" id="in_dado_custo_real" data-placeholder="true" onfocus="ChangeColor(this)" onblur="BackColor(this)" onkeypress="mascara(this, sonumeros_decimais)" placeholder="Custo real" disabled="" value="' + aux_custoReal_preench + '" />',
                                    '<img src="images/money-bill-alt.png" width="20" style="position: relative; float: right; bottom: 26px; right: 10px;" />',
                                    '</div>',
                                    '</div>',
                                    '</table>',
                                    '</li>'
                                ].join('');
                            }

                            if (e_construtora == '0') {
                                dados_observacao = [
                                    '<li style="padding: .7em 1em; background: #fff;" class="shadow_box" style="border-radius: 0;">',
                                    '<table>',
                                    '<div class="ui-grid ui-responsive">',
                                    '<div class="ui-block-a ui-grid-full">',
                                    '<table data-role="table" id="table-column-toggle" class="ui-responsive table-stroke">',
                                    '<tbody>',
                                    '<label style="font-weight: 600;" class="label-center" for="textarea-1">Observações</label>',
                                    '<label style="margin-top: 15px;" for="">Condomínio:</label>',
                                    '<textarea rows="3" style="width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 condominio" name="textarea-1" id="txt_dado_condominio" data-placeholder="true" placeholder="Condomínio..." onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">' + observacao_evento + '</textarea>',
                                    '<fieldset data-role="controlgroup">',
                                    '<div id="form_email" style="background: #f5f5f5; position: relative; top: 3px; padding: 3px; border-radius: 4px; border: 1px solid #dddddd;">',
                                    '<input style="position: relative; top: 1px; padding-right: 100%;" type="checkbox" name="email_condominio" id="email_condominio">',
                                    '<span style="font-size: 12px; position: relative; bottom: 1.8px;"><span style="color: rgb(153, 0, 0);">Marque para enviar um alerta</span> por email a construtora.</span>',
                                    '</div>',
                                    '</fieldset>',
                                    '</tbody>',
                                    '<tbody>',
                                    '<label style="margin-top: 10px;" for="">Construtora:</label>',
                                    '<textarea rows="3" style="background: #e7e7e7; width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 construtora" name="textarea-1" id="txt_dado_construtora" data-placeholder="true" placeholder="Construtora..." onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" readonly="readonly">' + observacao_evento_construtora + '</textarea>',
                                    '</tbody>',
                                    '</table>',
                                    '</div>',
                                    '</div>',
                                    '</table>',
                                    '</li>'
                                ].join('');
                            } else {
                                dados_observacao = [
                                    '<li style="padding: .7em 1em; background: #fff;" class="shadow_box" style="border-radius: 0;">',
                                    '<table>',
                                    '<div class="ui-grid ui-responsive">',
                                    '<div class="ui-block-a ui-grid-full">',
                                    '<table data-role="table" id="table-column-toggle" class="ui-responsive table-stroke">',
                                    '<tbody>',
                                    '<label style="font-weight: 600;" class="label-center" for="textarea-1">Observações</label>',
                                    '<label style="margin-top: 15px;" for="">Condomínio:</label>',
                                    '<textarea rows="3" style="background: #e7e7e7; width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 condominio" name="textarea-1" id="txt_dado_condominio" data-placeholder="true" placeholder="Condomínio..." onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" readonly="readonly">' + observacao_evento + '</textarea>',
                                    '</tbody>',
                                    '<tbody>',
                                    '<label style="margin-top: 10px;" for="">Construtora:</label>',
                                    '<textarea rows="3" style="width: 100%; border-color: #dddddd; font-size: 13px; outline: none; border-radius: 4px; padding: 5px; resize: none" class="size-14 construtora" name="textarea-1" id="txt_dado_construtora" data-placeholder="true" placeholder="Construtora..." onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)">' + observacao_evento_construtora + '</textarea>',
                                    '<fieldset data-role="controlgroup">',
                                    '<div style="background: #f5f5f5; position: relative; top: 3px; padding: 3px; border-radius: 4px; border: 1px solid #dddddd;">',
                                    '<input style="position: relative; top: 1px; padding-right: 100%;" type="checkbox" name="email_construtora" id="email_construtora">',
                                    '<span style="font-size: 12px; position: relative; bottom: 1.8px;"><span style="color: rgb(153, 0, 0);">Marque para enviar um alerta</span> por email ao condomínio.</span>',
                                    '</div>',
                                    '</fieldset>',
                                    '</tbody>',
                                    '</table>',
                                    '</div>',
                                    '</div>',
                                    '</table>',
                                    '</li>'
                                ].join('');
                            }

                            dados_ajuda_docs = [
                                '<div class="screen-over-content ui-responsive">',
                                '<div class="title-content">',
                                '<span class="size-14">Documentos a serem anexados para esta manutenção:</span>',
                                '<span style="text-align: center;" class="size-14" style="display: block;">',
                                '<strong>Nota fiscal</strong>',
                                '</span>',
                                '</div>',
                                '<div class="image-content">',
                                '<img style="width: 100%; height: auto;" src="https://www.sigmacivil.com.br/us/imagens/ajuda_docs/' + id_ajuda_docs + '.gif" alt="" />',
                                '</div>',
                                '<div class="title-content" style="margin-top: 15px;">',
                                '<span style="text-align: center;" class="size-14">Arquivo de exemplo</span>',
                                '</div>',
                                '</div>'
                            ].join('')

                            document.getElementById('nome_empree_id').innerHTML = nome_empree
                            document.getElementById('dados_ajuda').innerHTML = dados_ajuda_docs
                            document.getElementById('dados_manut').innerHTML = ini_lista + dados_manutencao + fim_lista
                            document.getElementById('dados_obs').innerHTML = dados_observacao

                            document.getElementById('popup_img').innerHTML = dados_popup_img

                            document.getElementById('imagens_bco').innerHTML = trecho_imagens_cond_imagens
                            document.getElementById('videos_bco').innerHTML = trecho_imagens_cond_videos
                            document.getElementById('audios_bco').innerHTML = trecho_imagens_cond_audios
                            document.getElementById('textos_bco').innerHTML = trecho_imagens_cond_textos

                            document.getElementById('imagens_bco_constr').innerHTML = trecho_imagens_constr_imagens
                            document.getElementById('videos_bco_constr').innerHTML = trecho_imagens_constr_videos
                            document.getElementById('audios_bco_constr').innerHTML = trecho_imagens_constr_audios
                            document.getElementById('textos_bco_constr').innerHTML = trecho_imagens_constr_textos
                            $('#q_empree').listview();

                            eval(variavelx);
                            eval(variavelx2);

                        }

                    } else {
                        alert("Problemas com sua conexao internet. Erro: 0167");
                    }
                }
            }
            ajax2.send();
            ////  capturando dados do evento

            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it

            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
                    var len = results.rows.length;
                    var i;
                    var meio_empree = "";
                    var final_empree = "";
                    var tam_ti;
                    var aux_image_upload;


                    if (len == 0) {
                        var rrr_caminho_imagens = ""
                        var rrr_caminho_texto = ""
                        var rrr_caminho_audio = ""
                        var rrr_caminho_video = ""
                        var rrr_id_prog_manut = id_prog_manut
                        var rrr_status_caminho_imagens = ""
                        var rrr_status_caminho_video = ""
                        var rrr_status_caminho_audio = ""
                        var rrr_status_caminho_texto = ""
                    }
                    else {
                        var row = results.rows.item(0)
                        var rrr_caminho_imagens = row['caminho_imagens'];
                        var rrr_caminho_texto = row['caminho_texto'];
                        var rrr_caminho_audio = row['caminho_audio'];

                        apagar1 = rrr_caminho_audio

                        var rrr_caminho_video = row['caminho_video'];
                        var rrr_id_prog_manut = row['id_prog_manut']
                        var rrr_status_caminho_imagens = row['status_imagens_upl']
                        var rrr_status_caminho_video = row['status_video_upl']
                        var rrr_status_caminho_audio = row['status_audio_upl']
                        var rrr_status_caminho_texto = row['status_texto_upl']
                    }

                    var todas_imagens = ""
                    var todas_status_imagens = ""
                    if (rrr_caminho_imagens == null || rrr_caminho_imagens == "") {
                        tam_ti = 0;
                    }
                    else {
                        todas_imagens = rrr_caminho_imagens.split("**")
                        todas_status_imagens = rrr_status_caminho_imagens.split("**")
                        tam_ti = todas_imagens.length;
                    }

                    var selec_imagens_thumb = ""
                    var selec_imagens = ""

                    for (k = 0; k < tam_ti; k++) {

                        if (todas_status_imagens[k] == '0') {
                            aux_image_upload = 'upload.png';
                            qtdDocs_Device += 1
                        }
                        else {
                            aux_image_upload = 'upload_verde.png';
                        }
                        //imagens da seta, preta ou verde

                        selec_imagens_thumb = selec_imagens_thumb + "<div style='float:left; position: relative; left: 1.5px;'><div style='border: 1px solid #5d5d5d'><table cellpadding='0' cellspacing='0'><img src='" + todas_imagens[k] + "'  onclick='abrir_popup(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + "," + String.fromCharCode(34) + k + String.fromCharCode(34) + " )'  width='106' height='70' hspace='2' vspace='2'/><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 5px; text-shadow: none;' class='icon-size' width='15' onclick='deletar_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")'></div><div align='center'><img src='images/" + aux_image_upload + "' style='float: right; padding: 0.5rem; position: relative; right: 5px; text-shadow: none;' class='icon-size' width='17' onclick='upload_imagem(" + String.fromCharCode(34) + k + String.fromCharCode(34) + ")' s></div></table></div></div></div>"
                        selec_imagens = selec_imagens + "<div data-role='popup' id='idpopup_" + rrr_id_prog_manut + "_" + k + "'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right'>Close</a> <img class='popphoto' src='" + todas_imagens[k] + "' style='max-height:512px;'> </div>"

                        //Popup
                    }


                    if (rrr_status_caminho_audio == '0') {
                        aux_image_upload = "upload.png";
                    }
                    else {
                        aux_image_upload = "upload_verde.png";
                    }
                    //se ta preta ou verde do áudio

                    var selec_audio;
                    if (rrr_caminho_audio == "") {
                        selec_audio = "<div style='position: relative; left: 15px; top: 17px;'><table cellpadding='0' cellspacing='0'><div id='latesq_" + rrr_id_prog_manut + "'width='40' height='30' style='display:none'></div><img src='images/play.svg' width='15' class='button-play top-9px' id='player_" + rrr_id_prog_manut + "'onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")'  style='display:none'><img src='images/pause.svg' width='15' class='button-pause top-9px position-icons' id='pause_" + rrr_id_prog_manut + "'onclick='pause_audio()' style='display:none'><img src='images/stop.svg' width='15' class='button-stop top-9px position-icons' id='stop_" + rrr_id_prog_manut + "'onclick='stop_audio()' style='display:none'><img src='images/microphone.svg' width='15' class='button-microfone top-9px position-icons' id='rec_" + rrr_id_prog_manut + "'onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")' style='display:none'><div id='latdir_" + rrr_id_prog_manut + "'width='40' height='30' style='display:none'></div><div align='center'><img src='images/trash.svg' class='icon-size' width='15' onclick='deletar_audio()' style='display:none'></div><div align='center'><img src='images/" + aux_image_upload + "' class='icon-size' width='16' onclick='upload_audio()' style='display:none'></div></table></div>"
                    }
                    else {
                        selec_audio = "<div class='icon-size' style='position: relative; text-align: center; top: 10px;'><table cellpadding='0' cellspacing='0'><div id='latesq_" + rrr_id_prog_manut + "'width='40' height='30'></div><div style='border: 1px solid black; width: 60%; border-radius: 20px; margin: 0 auto; padding: 5px;'><img src='images/play.svg' width='15' style='margin-right: 5px;' class='top-9px' id='player_" + rrr_id_prog_manut + "'onclick='abrir_audio(" + String.fromCharCode(34) + rrr_caminho_audio + String.fromCharCode(34) + ")' ><img src='images/pause.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='pause_" + rrr_id_prog_manut + "' onclick='pause_audio()'><img src='images/stop.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='stop_" + rrr_id_prog_manut + "'onclick='stop_audio()'><img src='images/microphone.svg' width='15' style='margin-right: 5px;' class='top-9px position-icons' id='rec_" + rrr_id_prog_manut + "'onclick='captureAudio(" + String.fromCharCode(34) + rrr_id_prog_manut + String.fromCharCode(34) + ")'></div><div id='latdir_" + rrr_id_prog_manut + "'width='40' height='30'></div><div align='center'><img src='images/trash.svg' style='position: relative; top: 8px; right: 55px; text-align: center; text-shadow: none;' class='icon-size' width='15' onclick='deletar_audio()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='position: relative; bottom: 10px; left: 45px; text-align: center; text-shadow: none;' class='icon-size' width='17' onclick='upload_audio()'></div></table></div>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                        }
                    }
                    //barra do áudio


                    if (rrr_status_caminho_video == '0') {
                        aux_image_upload = 'upload.png';
                    }
                    else {
                        aux_image_upload = 'upload_verde.png';
                    }
                    //setinha do vídeo

                    var selec_video;
                    if (rrr_caminho_video == "") {
                        selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:none; margin-left: 5px;'><table cellpadding='0' cellspacing='0'><video id='qvideo_" + rrr_id_prog_manut + "' controls poster='images/video.png' width='150' height='150'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 55px;' class='icon-size' width='15' onclick='deletar_video()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='padding: 0.5rem;' class='icon-size' width='17' onclick='upload_video()'></div></table></div>"
                    }
                    else {
                        selec_video = "<div id='video_invis_" + rrr_id_prog_manut + "' style='display:inline; margin-left: 5px;'><table cellpadding='0' cellspacing='0'><video id='qvideo_" + rrr_id_prog_manut + "' controls poster='images/video.png' width='150' height='150'>   <source id='qsource_" + rrr_id_prog_manut + "' src='" + rrr_caminho_video + "' type='video/mp4'></video><div align='center'><img src='images/trash.svg' style='float: left; padding: 0.5rem; position: relative; left: 55px; text-shadow: none;' class='icon-size' width='15' onclick='deletar_video()'></div><div align='center'><img src='images/" + aux_image_upload + "' style='padding: 0.5rem; float: left; position: relative; left: 120px; text-shadow: none;' class='icon-size' width='17' onclick='upload_video()'/></div></table></div>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                        }
                    }
                    //barrinha do vídeo

                    if (rrr_status_caminho_texto == '0') {
                        aux_image_upload = 'upload.png';
                    }
                    else {
                        aux_image_upload = 'upload_verde.png';
                    }
                    //seta do texto

                    var selec_texto;
                    selec_texto = rrr_caminho_texto;

                    var bot_up
                    if (rrr_caminho_texto == "") {
                        bot_up = "<div style='display:none'><img src='images/" + aux_image_upload + "' class='icon-size' width='17' onclick='upload_texto()'></i></div>"
                    }
                    else {
                        bot_up = "<img src='images/" + aux_image_upload + "' style='float: right; position: relative; right: 120px; top: 3px; text-shadow: none;' class='icon-size' width='17' onclick='upload_texto()'></i>"
                        if (aux_image_upload === "upload.png") {
                            qtdDocs_Device += 1
                        }
                    }

                    var item_camera = [
                        '<img src="images/camera.svg" style="margin-top: 10px; float: left; text-shadow: none;" onclick="getPhoto(pictureSource.CAMERA,' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="40" height="30" style="cursor:pointer"><div style="width: 200px;"><img id="foto_' + rrr_id_prog_manut + '" src=""  onclick="abrir_popup_new(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"  width="106" height="70" hspace="2" vspace="2"  style="display:none"/> </div>  <div data-role="popup" id="idpopup_new_' + rrr_id_prog_manut + '"> <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a> <img id="foto_big_' + rrr_id_prog_manut + '"  class="popphoto" src="" style="max-height:512px;"> </div> ' + selec_imagens_thumb + selec_imagens
                        // '<i class="fas fa-camera fa-2x top-9px" style="margin-top: 10px; height: 100%; float: left; text-shadow: none;" onclick="getPhoto(pictureSource.CAMERA,' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" width="38" height="28" style="cursor:pointer"></i><div style="width: 200px;"><img id="foto_' + rrr_id_prog_manut + '" src=""  onclick="abrir_popup_new(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"  width="106" height="70" hspace="2" vspace="2"  style="display:none"/> </div>  <div data-role="popup" id="idpopup_new_' + rrr_id_prog_manut + '"> <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a> <img id="foto_big_' + rrr_id_prog_manut + '"  class="popphoto" src="" style="max-height:512px;"> </div> ' + selec_imagens_thumb + selec_imagens
                    ]

                    var item_video = [
                        '<img src="images/video.svg" id="campo3" style="margin-top: 10px; float: left; text-shadow: none;" width="40" height="30" onclick="captureVideo(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')"><div style="display: inline">' + selec_video + '</div>'
                    ]

                    var item_audio = [
                        '<img src="images/volume-up.svg" style="margin-top: 10px; float: left; text-shadow: none;" width="40" height="30" onclick="captureAudio(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" style="cursor:pointer"></i>' + selec_audio
                    ]

                    var item_texto = [
                        '<div style="display: flex"><img src="images/file-alt.svg" style="margin-top: 10px; float: left; display: inline; text-shadow: none;" width="40" height="30"></i><textarea style="display: flex; border-color: #e4e4e4; border-radius: 3px; width: 100%; padding: 5px; outline: none; resize: none" class="size-14 text_hover" rows="3" cols="32" name="textarea-1" id="textarea_' + rrr_id_prog_manut + '" data-placeholder="true" placeholder="Digite suas observações aqui..." onfocus="ChangeColorBlue(this)" onblur="BackColorBlue(this)" maxlength="700">' + selec_texto + '</textarea></div><img src="images/save.svg" style="position: relative; float: left; left: 120px; top: 3px; text-shadow: none;" class="icon-size" width="15" onclick="atualizar_texto(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" style="cursor:pointer"><div align="center">' + bot_up + '</div>'
                    ]

                    var item_voltar = [
                        '<button onclick="atualizar_texto_empree(' + String.fromCharCode(39) + rrr_id_prog_manut + String.fromCharCode(39) + ')" type="button" class="ui-btn block btn-radius btn-voltar">Voltar</button>'
                    ]

                    document.getElementById('capturar_foto').innerHTML = item_camera;
                    document.getElementById('capturar_video').innerHTML = item_video;
                    document.getElementById('capturar_audio').innerHTML = item_audio;
                    document.getElementById('capturar_texto').innerHTML = item_texto;
                    document.getElementById('btn-voltar').innerHTML = item_voltar;

                    ///////////////////  Acionar .popup para imagens iniciarem escondidas  //////////////
                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
                        var len2 = results.rows.length;
                        var i2;
                        var tam_ti2;

                        if (len2 == 0) {
                            var rrr2_caminho_imagens = ""
                            var rrr2_id_prog_manut = id_prog_manut
                        }
                        else {
                            var row2 = results.rows.item(0)

                            var rrr2_caminho_imagens = row2['caminho_imagens'];
                            var rrr2_id_prog_manut = row2['id_prog_manut']
                        }


                        var todas_imagens2 = ""
                        var tam_ti2
                        if (rrr2_caminho_imagens == null || rrr2_caminho_imagens == "") {
                            tam_ti2 = 0;
                        }
                        else {
                            todas_imagens2 = rrr2_caminho_imagens.split("**")
                            tam_ti2 = todas_imagens2.length;
                        }


                        for (k = 0; k < tam_ti2; k++) {
                            $("#idpopup_" + rrr2_id_prog_manut + "_" + k).popup();
                        }

                        $("#idpopup_new_" + rrr2_id_prog_manut).popup();

                    }, null);
                    /////////////////// FIM - Acionar .popup para imagens iniciarem escondidas  //////////////


                }, null);
            });

        }

        var aux_caminho_imagens = ""
        var aux_status_imagens_upl = ""

        function getPhoto(source, qual) {

            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            var r = confirm("Para tirar uma foto com a câmera selecione OK.");
            if (r == true) {
                source = pictureSource.CAMERA;
            } else {
                source = pictureSource.PHOTOLIBRARY;
            }

            navigator.camera.getPicture(onPhotoURISuccess, onFail, {
                quality: 50,
                destinationType: destinationType.FILE_URI,
                encodingType: Camera.EncodingType.JPEG,
                popoverOptions: CameraPopoverOptions,
                sourceType: source
            });

        }

        function onFail(message) {
            // alert('Failed because: ' + message);
        }

        var qual_id_prog_manut;

        function onPhotoURISuccess(imageURI) {
            document.getElementById('foto_' + qual_id_prog_manut).src = imageURI;
            document.getElementById('foto_' + qual_id_prog_manut).style.display = "inline";

            var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db2.transaction(function (tx) {

                tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
                    var len = results.rows.length;
                    var i;

                    if (len == 0) {
                        aux_caminho_imagens = ""
                        tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_imagens,caminho_audio, caminho_video, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","0","","","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, imageURI]);
                    }
                    else {
                        var row = results.rows.item(0)
                        aux_caminho_imagens = row['caminho_imagens'];

                        if (aux_caminho_imagens != "") {
                            aux_caminho_imagens = aux_caminho_imagens + '**';

                            aux_status_imagens_upl = row['status_imagens_upl'];
                            aux_status_imagens_upl = aux_status_imagens_upl + '**';
                            aux_status_imagens_upl = aux_status_imagens_upl + '0';
                        } else {
                            aux_status_imagens_upl = '0';
                        }

                        tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_imagens="' + aux_caminho_imagens + imageURI + '" , status_imagens_upl="' + aux_status_imagens_upl + '" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

                    }

                    reload_page();
                    // terminou de tirar a foto, aqui é a seleção da seta

                }, null);

            });

        }

        // DELETAR IMAGEM
        function deletar_imagem(q_id) {
            var q_id;
            var all_images;
            var all_status_images;
            var taman;
            var aux_1 = "";
            var aux_1_status = "";

            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db.transaction(function (tx) {

                tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
                    var k;

                    var row = results.rows.item(0)
                    aux_caminho_imagens = row['caminho_imagens'];
                    aux_status_imagens_upl = row['status_imagens_upl'];

                    all_images = aux_caminho_imagens.split("**")
                    all_status_images = aux_status_imagens_upl.split("**")
                    taman = all_images.length;

                    for (k = 0; k < taman; k++) {
                        if (q_id != k) {
                            aux_1 = aux_1 + all_images[k] + "**"
                            aux_1_status = aux_1_status + all_status_images[k] + "**"
                        }
                    }

                    if (taman > 1) {
                        var aux_2 = aux_1.substring(0, aux_1.length - 2)
                        var aux_2_status = aux_1_status.substring(0, aux_1_status.length - 2)
                    } else if (taman == 0 || taman == 1) {
                        var aux_2 = ""
                        var aux_2_status = ""
                    }

                    tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_imagens="' + aux_2 + '" , status_imagens_upl="' + aux_2_status + '"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

                    reload_page();

                }, null);
            });

        }
        // FIM DELETAR IMAGEM

        // UPLOAD IMAGEM
        var aux_1_status = "";

        function upload_imagem(q_id) {

            if (tem_conexao()) {

                var q_id;
                var all_images;
                var all_status_images;
                var taman;
                var aux_1 = "";

                var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {
                        var k;

                        var row = results.rows.item(0)
                        aux_caminho_imagens = row['caminho_imagens'];

                        all_images = aux_caminho_imagens.split("**")

                        aux_1 = aux_1 + all_images[q_id] + "**"
                        var aux_2 = aux_1.substring(0, aux_1.length - 2)

                        // marcar que foi feito upload para esta imagem

                        aux_status_imagens_upl = row['status_imagens_upl'];

                        all_status_images = aux_status_imagens_upl.split("**");
                        taman = all_status_images.length;

                        for (k = 0; k < taman; k++) {
                            if (q_id != k) {
                                aux_1_status = aux_1_status + all_status_images[k] + "**"
                            }
                            else {
                                aux_1_status = aux_1_status + "1" + "**"
                                var ja_fez_upload = all_status_images[k]
                            }
                        }

                        aux_1_status = aux_1_status.substring(0, aux_1_status.length - 2)
                        // fim  marcar que foi feito upload para esta imagem
                        if (ja_fez_upload != '1') {
                            up_loadPhoto(aux_2, q_id, aux_1_status);
                        }
                        else {
                            up_loadPhoto(aux_2, q_id, aux_status_imagens_upl);
                        }

                    }, null);
                });

            }
        }

        function up_loadPhoto(imageURI, q_k) {

            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"

            var q_k;
            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
            options.mimeType = "image/jpeg";

            var params = new Object();
            params.value1 = "test";
            params.value2 = "param";

            options.params = params;
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(imageURI, "http://www.sigmacivil.com.br/app_sc/rec_foto_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente + "&q_k=" + q_k, win_up, fail_up, options);

        }

        var win_up = function (r) {

            var db3 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
            db3.transaction(function (tx) {

                tx.executeSql('UPDATE mtab_prog_manut_evento SET status_imagens_upl="' + aux_1_status + '" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

                reload_page();

            });

        }

        var fail_up = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            alert("Não foi feito o upload da imagem!");
        }
        // FIM UPLOAD IMAGEM

        // FIM CAMERA

        // CAPTURAR VIDEO
        function captureVideo(qual) {
            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            // var r = confirm('Escolha vídeo ou galeria')
            // if (r == true) {
            navigator.device.capture.captureVideo(videocaptureSuccess, videocaptureError, { limit: 1, duration: 15 });
            // } else {
            //     navigator.camera.getPicture(videocaptureSuccess, videocaptureError, {
            //         limit: 1,
            //         duration: 15,
            //         quality: 50,
            //         destinationType: Camera.DestinationType.FILE_URI,
            //         sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
            //         mediaType: Camera.MediaType.VIDEO
            //     });
            // }
        }

        function videocaptureSuccess(mediaFiles) {
            var i, len;
            var m_path;

            for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                m_path = mediaFiles[i].fullPath;

                document.getElementById('video_invis_' + qual_id_prog_manut).style.display = "inline";

                var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db2.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
                        var len2 = results.rows.length;

                        if (len2 == 0) {
                            tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_video,caminho_imagens,caminho_audio, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","","0","","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, m_path]);
                        }
                        else {
                            var row = results.rows.item(0)
                            tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_video="' + m_path + '" , status_video_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                        }

                        reload_page();

                    }, null);

                });

            }
        }

        // FIM CAPTURAR VIDEO

        function videocaptureError(error) {
            var msg = 'Ocorreu um erro durante a captura do vídeo: ' + error.code;
        }

        // DELETAR VIDEO
        function deletar_video() {

            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db.transaction(function (tx) {

                tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_video="" , status_video_upl="0"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                reload_page();
            });

        }
        // FIM DELETAR VIDEO

        function upload_video() {

            if (tem_conexao()) {

                var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

                        var row = results.rows.item(0)

                        if (row['status_video_upl'] != '1') {
                            var aux_caminho_video = row['caminho_video'];
                            //tx.executeSql('UPDATE mtab_prog_manut_evento SET status_video_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
                            up_loadVideo(aux_caminho_video);
                        }
                        else {
                            var aux_caminho_video = row['caminho_video'];
                            up_loadVideo(aux_caminho_video);
                        }

                    }, null);
                });

            }
        }

        // UPLOAD VIDEO
        function up_loadVideo(videoURL) {

            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"

            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = videoURL.substr(videoURL.lastIndexOf('/') + 1);
            options.mimeType = "video/mp4";
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(videoURL, "http://www.sigmacivil.com.br/app_sc/rec_video_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente, win_up_v, fail_up_v, options);

        }

        var win_up_v = function (r) {
            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db.transaction(function (tx) {
                tx.executeSql('UPDATE mtab_prog_manut_evento SET status_video_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

                // alert("Vídeo enviado com sucesso!");
                reload_page();
            });
        }

        var fail_up_v = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            alert("Não foi feito o upload da vídeo!");
        }
        // FIM UPLOAD VIDEO

        // CAPTURAR AUDIO
        var myMedia3 = null;
        var esta_pausado = 0;

        function captureAudio(qual) {
            qual_id_prog_manut = qual;

            // RESTRIÇÕES DE DATAS
            if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
        }

        function captureSuccess(mediaFiles) {
            var i, len;
            var m_path;

            for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                m_path = mediaFiles[i].fullPath;

                if ((m_path.substring(0, 6) == "file:/") && (m_path.substring(6, 7) != "/")) {
                    m_path = m_path.replace("file:/", "file:///");
                }
                else {
                    m_path = m_path;
                }

                document.getElementById('player_' + qual_id_prog_manut).onclick = function () {
                    abrir_audio(m_path);
                };
                document.getElementById('latesq_' + qual_id_prog_manut).style.display = "inline";
                document.getElementById('player_' + qual_id_prog_manut).style.display = "inline";
                document.getElementById('pause_' + qual_id_prog_manut).style.display = "inline";
                document.getElementById('stop_' + qual_id_prog_manut).style.display = "inline";
                document.getElementById('rec_' + qual_id_prog_manut).style.display = "inline";
                document.getElementById('latdir_' + qual_id_prog_manut).style.display = "inline";

                var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db2.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
                        var len2 = results.rows.length;

                        if (len2 == 0) {
                            tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_video,caminho_imagens,caminho_audio, caminho_texto, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,"","",?,"","","","0","")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, m_path]);
                        }
                        else {
                            var row = results.rows.item(0)
                            tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_audio="' + m_path + '" , status_audio_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                        }

                        reload_page();

                    }, null);

                });

            }
        }

        function captureError(error) {
            var msg = 'Ocorreu um erro durante a captura do áudio: ' + error.code;
        }

        function abrir_audio(qual) {
            if (esta_pausado == 0) {
                myMedia3 = new Media(qual);
                myMedia3.play();
            }
            if (esta_pausado == 1) {
                myMedia3.play();
                esta_pausado = 0;
            }
        }

        function pause_audio() {
            if (myMedia3) {
                myMedia3.pause();
                esta_pausado = 1;
            }
        }

        function stop_audio() {
            if (myMedia3) {
                myMedia3.stop();
                esta_pausado = 0;
            }
        }
        // FIM CAPTURAR AUDIO

        // DELETAR AUDIO
        function deletar_audio() {
            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db.transaction(function (tx) {

                tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_audio="" , status_audio_upl="0"  WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                reload_page();
            });
        }
        // FIM DELETAR AUDIO

        // UPLOAD AUDIO
        function upload_audio() {

            if (tem_conexao()) {

                var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

                        var row = results.rows.item(0)

                        if (row['status_audio_upl'] != '1') {
                            var aux_caminho_audio = row['caminho_audio'];
                            //tx.executeSql('UPDATE mtab_prog_manut_evento SET status_audio_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
                            up_loadAudio(aux_caminho_audio);
                        }
                        else {
                            var aux_caminho_audio = row['caminho_audio'];
                            up_loadAudio(aux_caminho_audio);
                        }


                    }, null);
                });

            }
        }

        function up_loadAudio(audioURL) {

            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"

            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = audioURL.substr(audioURL.lastIndexOf('/') + 1);
            options.mimeType = "audio/amr";
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(audioURL, "http://www.sigmacivil.com.br/app_sc/rec_audio_uploaded.php?idpm=" + id_prog_manut + "&dia=" + dia_ev + "&mes=" + mes_ev + "&ano=" + ano_ev + "&versao=2.0&econst=" + e_construtora + "&idc=" + id_cliente, win_up_a, fail_up_a, options);

        }

        var win_up_a = function (r) {
            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
            db.transaction(function (tx) {
                tx.executeSql('UPDATE mtab_prog_manut_evento SET status_audio_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');

                reload_page();

            });
        }

        var fail_up_a = function (error) {
            document.getElementById("parte_load_content").style.display = "none";
            document.getElementById("parte_load").style.display = "none";
            alert("Não foi feito o upload da áudio!");
        }
        // FIM UPLOAD AUDIO

        // UPLOAD TEXTO
        function upload_texto() {

            // RESTRIÇÕES DE DATAS
            if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa ação só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
                return
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa ação não pode ser realizada após o dia " + dateToEN(d_max) + "!")
                return
            }

            if (tem_conexao()) {

                var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                db.transaction(function (tx) {

                    tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '" ', [], function (tx, results) {

                        var row = results.rows.item(0)

                        if (row['status_texto_upl'] != '1') {
                            var aux_caminho_texto = row['caminho_texto'];
                            //tx.executeSql('UPDATE mtab_prog_manut_evento SET status_texto_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"' );
                            up_loadTexto(aux_caminho_texto);
                        }
                        else {
                            var aux_caminho_texto = row['caminho_texto'];
                            up_loadTexto(aux_caminho_texto);
                        }

                    }, null);
                });

            }
        }

        function up_loadTexto(textoURL) {

            document.getElementById("parte_load_content").style.display = "block";
            document.getElementById("parte_load").style.display = "flex";
            window.location.href = "#ancora123"

            var data = 'tx=' + encodeURIComponent(textoURL) + '&ipm=' + id_prog_manut + '&d=' + dia_ev + '&m=' + mes_ev + '&a=' + ano_ev + "&econst=" + e_construtora + "&idc=" + id_cliente;
            var ajax = new XMLHttpRequest();
            ajax.open("POST", "https://www.sigmacivil.com.br/app_sc/rec_texto_uploaded.asp?versao=2.0", true);
            ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4) {//Request complete !!
                    if (ajax.status == 200 || ajax.status == 0) { // OK response

                        var resposta_total = ajax.responseText;
                        if (resposta_total == "grav_ok") {
                            var db = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
                            db.transaction(function (tx) {
                                tx.executeSql('UPDATE mtab_prog_manut_evento SET status_texto_upl="1" WHERE mtab_prog_manut_evento.id_prog_manut="' + id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                                // alert("Texto enviado com sucesso!");
                                reload_page(); // adicionar aqui a estrutura para certiifcar que foi upado
                            });
                        }
                        else {
                            alert("Problemas com a gravação do texto. Tente novamente mais tarde.");
                        }

                    }
                    else {
                        alert("Problemas com sua conexão internet. Erro: 01");
                    }
                }

            }

            data = data.split(":").join("%3A")
            data = data.split("{").join(" % 7B")
            data = data.split("}").join("%7D")
            data = data.split(",").join("%2C")
            data = data.split("[").join("%5B")
            data = data.split("]").join("%5D")
            data = data.split(String.fromCharCode(34)).join("%22")

            ajax.send(data);

        }
        // FIM UPLOAD TEXTO

    </script>

</head>

<body>
    <!-- POPUP DA IMAGEM DA GALERIA DE IMAGENS SERVIDOR -->
    <div style="position: fixed; z-index: 5000;" id="popup_img"></div>

    <div id="parte_load_content"
        style="width: 100%; height: 100%; position: fixed; background: rgba(0,0,0,.5); z-index: 10;"></div>

    <!-- MENU ONLINE/OFFLINE -->
    <span id="menu_opc2"></span>

    <!-- NOME EMPREENDIMENTO -->
    <!-- <span id="nome_emp"></span> -->

    <!-- TELA DE LOADING AO ENVIAR ALGUM ARQUIVO PARA A GALERIA DE IMAGENS SERVIDOR -->
    <div id="parte_load" align="center">
        <table width="224" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="42" height="49">
                    <div align="center" style="background: rgba(0,0,0,.5); padding: 1rem; border-radius: 5px;">
                        <img src="images/tail-spin.svg" width="35" height="35">
                        <span class="quad_text">Aguarde o envio</span>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- <span id="vistoria"></!-->

    <!-- MENU BURGER -->
    <div class="btn-bars">
        <div style="top:4;" data-role="collapsible" data-collapsed="true" class="ui-btn-left menu" data-mini="true">
            <h4 class="btn-bars-bars">
                <!-- <span class="fas fa-bars"></span> -->
                <img class="is-bars" src="images/bars.svg" width="14" alt="Menu" />
                <img class="is-times is-disabled" src="images/times.svg" width="13" alt="Menu" />
            </h4>
            <ul style="border: 1px solid #e0e0e0;" data-role="listview" data-mini="true">
                <li><a style="z-index: 10" class="click" href="#" onClick="enviar_sync()">Novo Login</a></li>
            </ul>
        </div>
    </div>

    <!-- NOME EMPREENDIMENTO -->
    <div style="text-align: center;">
        <h4 id="nome_empree_id" style="display: inline; position: relative; bottom: 2px;"></h4>
    </div>

    <!-- FILTRO DE BUSCAS DE MANUTENÇÕES -->
    <ul class="list-content" data-mini="true" data-role="listview" data-filter="true"
        data-filter-placeholder="Buscar..." data-inset="true">

        <!-- DADOS DA MANUTENÇÃO ATÉ O CUSTO ESTIMADO/REAL -->
        <div id="dados_manut"></div>

        <!-- <div id="dados_val"></div> -->

        <!-- BLOCO GALERIA DE IMAGENS DO APARELHO -->
        <li class="shadow_box_gallery" style="border-radius: 0; background: #e7d8fc">
            <table>
                <div class="ui-grid ui-responsive">
                    <div class="ui-block-a ui-grid-full">
                        <table data-role="table" id="table-column-toggle" data-mode=""
                            class="ui-responsive table-stroke">
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <label style="text-shadow: none; font-weight: 600;" class="label_center_"
                                            for="textarea-1">Galeria
                                            de imagens do
                                            aparelho</label>
                                        <a style="float: right; position: relative; bottom: 28px; left: 16px;"
                                            href="#transitionExample" data-transition="pop" class="ui-btn-inline"
                                            data-rel="popup">
                                            <img src="images/question-circle.png" width="15" style="text-shadow: none; position: absolute; right: 0;">
                                        </a>
                                        <!-- BLOCO DE CÓDIGO DA CAMERA -->
                                        <a id="capturar_foto"></a>

                                        <img class="foto_small_" style="display: none;" id="foto_" src="" alt=""
                                            width="50" height="50">
                                        
                                        <!-- BLOCO DE CÓDIGO AO CLICAR O BOTÃO "?" -->
                                        <div data-role="popup" id="transitionExample" class="ui-content" data-theme="a">
                                            <div id="dados_ajuda"></div>
                                        </div>

                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR ÁUDIO -->
                            <tbody style="margin-top: 5px">
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <a id="capturar_audio"></a>
                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR VÍDEO -->
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid #fff">
                                        <a id="capturar_video"></a>
                                    </th>
                                </tr>
                            </tbody>
                            <!-- BLOCO DE CÓDIGO PARA CAPTURAR TEXTO -->
                            <tbody>
                                <tr>
                                    <th style="border-bottom: 1px solid transparent">
                                        <a id="capturar_texto"></a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </table>
        </li>

        <!-- BLOCO DE CÓDIGO DE COMENTÁRIOS DO CONDOMÍNIO E CONSTRUTORA -->
        <div id="dados_obs"></div>

        <!-- BLOCO DE CÓDIGO DA GALERIA DE IMAGENS SERVIDOR E BOTÕES SALVAR E VOLTAR -->
        <li class="shadow_box" style="border-radius: 0; padding-left: 1em;">
            <table>
                <div style="text-align: center;" class="ui-grid-a">
                    <a href="#overlay" data-transition="slideup"
                        style="background: #4793d0; text-shadow: none; color: #fff; position: relative; top: 0;"
                        class="ui-btn ui-icon-camera ui-btn-icon-left ui-corner-all" data-rel="popup">Galeria de
                        imagens servidor</a>
                    <div data-role="popup" id="overlay" class="ui-content" data-theme="a">
                        <a data-rel="back" class="ui-corner-all ui-shadow">
                            <button type="button" style="background: transparent; border: none; text-shadow: none; box-shadow: none; margin: 0; padding: 0; position: relative; bottom: 5px;">
                                <img style="float: right; position: relative; z-index: 10;" src="images/times.svg" width="15" alt="Close" />
                            </button>

                        </a>

                        <div class="ui-corner-all custom-corners">
                            <div style="background: #4793d0; border-color: #4793d0;"
                                class="ui-bar ui-bar-a condominio_bar">
                                <h3 style="color: #fff; text-shadow: none;">Galeria de imagens do condomínio</h3>
                            </div>
                            <div class="condominio_content" id="condominio_content">
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Imagens:</strong>
                                    </h4>
                                    <div id="imagens_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Vídeos:</strong>
                                    </h4>
                                    <div id="videos_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Áudios:</strong>
                                    </h4>
                                    <div id="audios_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Textos:</strong>
                                    </h4>
                                    <div id="textos_bco"></div>
                                    <!-- <span id="galeria_vazia" class="is-red"></span> -->
                                </div>
                            </div>
                        </div>

                        <!-- GALERIA DE IMAGENS SERVIDOR -->
                        <div class="ui-corner-all custom-corners">
                            <div style="background: #4793d0; border-color: #4793d0;"
                                class="ui-bar ui-bar-a construtora_bar">
                                <h3 style="color: #fff; text-shadow: none;">Galeria de imagens da construtora</h3>
                            </div>
                            <div class="construtora_content" id="construtora_content">
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Imagens:</strong>
                                    </h4>
                                    <div id="imagens_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Vídeos:</strong>
                                    </h4>
                                    <div id="videos_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Áudios:</strong>
                                    </h4>
                                    <div id="audios_bco_constr"></div>
                                </div>
                                <div class="ui-body ui-body-a">
                                    <h4 class="margin">
                                        <strong>Textos:</strong>
                                    </h4>
                                    <div id="textos_bco_constr"></div>
                                </div>
                            </div>
                        </div>
                        <a data-rel="back" class="ui-corner-all ui-shadow botao_click">
                            <button style="background: #c70202; color: #fff; text-shadow: none;"
                                class="ui-btn ui-corner-all">Fechar</button>
                        </a>
                    </div>
                </div>
            </table>
        </li>

        <!-- BOTÕES SALVAR E VOLTAR -->
        <li class="shadow_box" style="border-radius: 0;">
            <table>
                <fieldset class="ui-grid-a">
                    <div class="ui-block-a ui-responsive">
                        <button type="button" class="ui-btn block btn-radius btn-salvar"
                            onclick="enviar_dados();">Salvar</button>
                    </div>
                    <div class="ui-block-b ui-responsive">
                        <div id="btn-voltar"></div>
                    </div>
                </fieldset>
            </table>
        </li>

    </ul>
    <div id="id_ev_email"></div>

    <a href="apagar.html">Apagar</a>
</body>

</html>

<script>
    $(document).ready(function () {
        $('.circle-question').mouseover(function () {
            $('.screen-over').fadeIn(400)
        })

        $('.fa-times').click(function () {
            $('.screen-over').hide()
        })

        $('.btn-bars .ui-btn').click(function () {
            $('.menu .fa-bars').toggleClass('fa-times')
        })

        $('.btn-bars-bars').click(function() {
            $('.is-bars').toggleClass('is-disabled')
            $('.is-times').toggleClass('is-disabled')
        })

        $('#parte_load').click(function () {
            $('html, body').animate({
                scrollTop: 1500
            }, 500)
        })

        $('.abrir_popup_foto').click(function () {
            $('.pop_photo_big').css({
                display: 'flex'
            })
        })

        $(".btn-salvar").click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 500);
        });

        $("#parte_load").click(function () {
            $('html, body').animate({
                scrollTop: 0
            }, 500);
        });

    })

    function FocusInput(element) {
        return element.click()
    }

</script>

<script>

    function abrir_popup(id1, id2) {
        var id1;
        var id2;

        $("#idpopup_" + id1 + "_" + id2).popup();
        $("#idpopup_" + id1 + "_" + id2).popup('open');
    }

    function abrir_popup_new(id) {
        var id;
        $("#idpopup_new_" + id).popup();
        $("#idpopup_new_" + id).popup('open');
    }



    function abrir_popup_gal(id1) {
        var id1;
        $("#idpopup_img_" + id1).css({ display: "flex" });
        $("#idpopup_img_" + id1).css({ display: "flex" });
        $("#popup_fundo_" + id1).css({ display: "block" });
    }

    function fechar_popup_gal(id1) {
        var id1;
        $("#idpopup_img_" + id1).css({ display: "none" });
        $("#idpopup_img_" + id1).css({ display: "none" });
        $("#popup_fundo_" + id1).css({ display: "none" });
    }

    var qual_id_prog_manut;

    // ATUALIZAR O TEXTO
    function atualizar_texto(qual) {
        var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
        var quale;

        qual_id_prog_manut = qual;
        quale = document.getElementById('textarea_' + qual).value;

        var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
        db2.transaction(function (tx) {

            tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
                var len2 = results.rows.length;

                if (len2 == 0) {
                    tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_texto,caminho_video,caminho_audio, caminho_imagens, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","","","","0")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, quale]);
                }
                else {
                    var row = results.rows.item(0)
                    tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_texto="' + quale + '" , status_texto_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                }

                reload_page();

            }, null);

        });
    }
    // FIM ATUALIZAR O TEXTO

    function atualizar_texto_empree(qual) {
        var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000);
        var quale;

        qual_id_prog_manut = qual;
        quale = document.getElementById('textarea_' + qual).value;

        var db2 = window.openDatabase("DB_SigmaCivil", "1.0", "DB_SigmaCivil", 200000); //will create database Dummy_DB or open it
        db2.transaction(function (tx) {

            tx.executeSql('SELECT * FROM mtab_prog_manut_evento WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"  ', [], function (tx, results) {
                var len2 = results.rows.length;

                if (len2 == 0) {
                    tx.executeSql('INSERT INTO mtab_prog_manut_evento(id_prog_manut,dia_evento,mes_evento,ano_evento,caminho_texto,caminho_video,caminho_audio, caminho_imagens, status_imagens_upl,status_video_upl,status_audio_upl,status_texto_upl) VALUES (?,?,?,?,?,"","","","","","","0")', [qual_id_prog_manut, dia_ev, mes_ev, ano_ev, quale]);
                }
                else {
                    var row = results.rows.item(0)
                    tx.executeSql('UPDATE mtab_prog_manut_evento SET caminho_texto="' + quale + '" , status_texto_upl="0" WHERE mtab_prog_manut_evento.id_prog_manut="' + qual_id_prog_manut + '"  AND dia_evento="' + dia_ev + '"  AND mes_evento="' + mes_ev + '" AND ano_evento="' + ano_ev + '"');
                }

                reload_page_empree();

            }, null);

        });
    }

    function reload_page() {
        //alert(document.getElementById('in_data_realizacao').value)
        window.location.assign("even_online.htm?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev + '&d_min=' + d_min + '&d_max=' + d_max + "&tipo=" + tipo + "&input_data_realiz=" + document.getElementById('in_data_realizacao').value + "&input_forn=" + document.getElementById('valores').value + "&input_custoReal=" + document.getElementById('in_dado_custo_real').value + "&input_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value))
    }

    function reload_page_empree() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            window.location.assign("empree.htm?e=" + id_empree + "&l=" + login + "&s=" + senha + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev))
        }
        else {
            window.location.assign("empree_online.htm?l=" + login + "&s=" + senha + "&e=" + id_empree + "&qm=" + parseInt(mes_ev) + "&qa=" + parseInt(ano_ev) + "&n=" + nome_sistema);
        }
    }

    function reload_page_even() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            window.location.assign("even.htm?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev)
        }
        else {
            window.location.assign("even_online.htm?l=" + login + "&s=" + senha + "&ipm=" + id_prog_manut + "&dia_ev=" + dia_ev + "&mes_ev=" + mes_ev + "&ano_ev=" + ano_ev + '&d_min=' + d_min + '&d_max=' + d_max + "&tipo=" + tipo)
        }
    }

    function tem_conexao() {
        if (navigator.connection.type == 0 || navigator.connection.type == 'none') {
            return false;
        }
        else {
            return true;
        }
    }

    function enviar_sync() {

        decisao = confirm("Confirmar efetuação de um novo login? Será necessário se logar novamente em qualquer empreendimento atualizando o plano de manutenção!");

        if (decisao) {
            document.form_sup.action = "del.htm";
            document.form_sup.submit();
        }

    }

    //////////////////////
    function mascara(o, f) {
        v_obj = o
        v_fun = f
        setTimeout("execmascara()", 1)
    }

    function execmascara() {
        v_obj.value = v_fun(v_obj.value)
    }

    function sonumeros_data(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que não é dígito
        v = v.replace(/(\d{2})(\d)/, "$1/$2")    //Coloca / entre o segundo e o quarto dígitos
        v = v.replace(/(\d{2})(\d)/, "$1/$2")    //Coloca / entre o quarto e o sexto dígitos
        return v
    }

    function sonumeros_decimais(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que não é dígito
        v = v.replace(/(\d{1})(\d{1,2})$/, "$1,$2")    //coloca virgula antes dos últimos 2 digitos
        return v
    }

    function sonumeros(v) {
        v = v.replace(/\D/g, "")       //Remove tudo o que não é dígito
        return v
    }

    function sonumeros_tel(v) {
        v = v.replace(/\D/g, "")       //Remove tudo o que não é dígito
        v = v.replace(/(\d{0})(\d)/, "$1($2")
        v = v.replace(/(\d{2})(\d)/, "$1)$2")
        return v
    }
    //////////////////////

    function dateToEN(date) {
        return date.split('-').reverse().join('/');
    }

    function dateToEN2(date) {
        return date.split('/').reverse().join('-');
    }

    function datadiff(d1, d2) {
        var t2 = new Date(d2).getTime();
        var t1 = new Date(d1).getTime();
        return parseInt((t2 - t1) / (24 * 3600 * 1000));
    }

    function datadiff2(d1, d2) {
        var t2 = Math.abs(new Date(d2).getTime());
        var t1 = Math.abs(new Date(d1).getTime());
        return Math.ceil(parseInt((t2 - t1) / (1000 * 3600 * 24)));
    }

    function enviar_dados() {
        var crypt_segur = (parseInt(id_empree) * 3) + 5 + (parseInt(id_cliente)) * 2 + 7

        if (e_construtora == 0) {

            var data = document.querySelector('.data_formato')
            var texto = ""
            var continuar = null

            var d = new Date()

            var aux_mes_novo = d.getMonth() + 1;
            aux_mes_novo = '0' + aux_mes_novo
            aux_mes_novo = aux_mes_novo.substring(aux_mes_novo.length - 2, aux_mes_novo.length);

            var aux_dia_novo = d.getDate();
            aux_dia_novo = '0' + aux_dia_novo
            aux_dia_novo = aux_dia_novo.substring(aux_dia_novo.length - 2, aux_dia_novo.length);

            var data_hoje_formatada = d.getFullYear() + '-' + aux_mes_novo + '-' + aux_dia_novo

            var $email_condominio = document.getElementById('email_condominio')
            if ($email_condominio.checked == true) {
                ev_email = 1
            } else {
                ev_email = 0
            }

            if (data.value == 0) {
                alert('Obrigatório o preenchimento da data da realização da manutenção!')
                FocusInput(data)
            } else if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa manutenção só pode ser informada a partir do dia " + dateToEN(d_min) + "!")
            } else if (datadiff(Date.now(), d_max) < 0) {
                alert("Essa manutenção não pode ser informada após o dia " + dateToEN(d_max) + "!")
            } else if (datadiff(dateToEN2(document.getElementById('in_data_realizacao').value), d_min) > 0) {
                alert("Essa manutenção só pode ser realizada a partir do dia " + dateToEN(d_min) + "!")
            } else if (datadiff(dateToEN2(document.getElementById('in_data_realizacao').value), d_max) < 0) {
                alert("Essa manutenção não pode ser realizada após o dia " + dateToEN(d_max) + "!")
            } else if (datadiff(dateToEN2(document.getElementById('in_data_realizacao').value), data_hoje_formatada) < 0) {
                alert("Essa manutenção não pode ser realizada após o dia de hoje!")
            } else if (nivel_manut == 2 && qt_docs == 0) {
                alert('Esta manutenção precisa de pelo menos 1 documento comprovatório anexado!')
            } else {
                if (nivel_manut == 1 && qt_docs == 0) {
                    var prosseguir = confirm('É importante anexar um documento que comprove esta manutenção. Tem certeza que deseja prosseguir sem anexar um comprovante?')
                    if (prosseguir == false) { return }
                }
                if (qtdDocs_Device > 0) {
                    if (qtdDocs_Device > 1) {
                        continuar = confirm(`Você ainda tem ${qtdDocs_Device} documentos neste aparelho que não estão anexados no servidor! Deseja prosseguir?`)
                    } else {
                        continuar = confirm(`Você ainda tem ${qtdDocs_Device} documento neste aparelho que não está anexado no servidor! Deseja prosseguir?`)
                    }
                    if (continuar == false) { return }
                }
                if (prosseguir == true || ((nivel_manut == 1 || nivel_manut == 2) && qt_docs > 0)) {
                    var ajax3 = new XMLHttpRequest();
                    ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/salvar_manut.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&econst=" + e_construtora + "&idpm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&d_data_realiz=" + document.getElementById('in_data_realizacao').value + "&d_forn=" + document.getElementById('valores').value + "&d_custoReal=" + document.getElementById('in_dado_custo_real').value + "&d_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value) + "&tipo=" + tipo + "&versao=2.0&env_em=" + ev_email + "&segur=" + crypt_segur + "&t=" + Math.random(), false);
                    ajax3.onreadystatechange = function () {
                        if (ajax3.readyState == 4) {
                            if (ajax3.status == 200 || ajax3.status == 0) {

                                var resposta_total = ajax3.responseText;
                                if (tipo == "alt") {
                                    alert("Alteração realizada com sucesso!")
                                } else {
                                    alert("Manutenção realizada com sucesso!")
                                }

                                reload_page_empree();

                            } else {
                                alert("Problemas com sua conexão internet. Erro: 0166");
                            }
                        }
                    }
                    ajax3.send();
                }
            }
        } else if (e_construtora == 1) {
            var $email_construtora = document.getElementById('email_construtora')
            if ($email_construtora.checked == true) {
                ev_email = 1
            } else {
                ev_email = 0
            }

            if (datadiff(Date.now(), d_min) > 0) {
                alert("Essa manutenção só pode ser informada a partir do dia " + dateToEN(d_min) + '!')
            } else if (datadiff(Date.now(), d_max) <= 0) {
                alert("Essa manutenção não pode ser informada após o dia " + dateToEN(d_max) + '!')
            } else {
                if (qtdDocs_Device > 0) {
                    if (qtdDocs_Device > 1) {
                        continuar = confirm(`Você ainda tem ${qtdDocs_Device} documentos neste aparelho que não estão anexados no servidor! Deseja prosseguir?`)
                    } else {
                        continuar = confirm(`Você ainda tem ${qtdDocs_Device} documento neste aparelho que não está anexado no servidor! Deseja prosseguir?`)
                    }
                    if (continuar == false) { return }
                }
                var ajax3 = new XMLHttpRequest();
                ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/salvar_manut.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&econst=" + e_construtora + "&idpm=" + id_prog_manut + "&d=" + dia_ev + "&m=" + mes_ev + "&a=" + ano_ev + "&d_data_realiz=" + document.getElementById('in_data_realizacao').value + "&d_forn=" + document.getElementById('valores').value + "&d_custoReal=" + document.getElementById('in_dado_custo_real').value + "&d_custoEstim=" + document.getElementById('in_dado_custo_estimado').value + "&d_obsCondo=" + removeAcento(document.getElementById('txt_dado_condominio').value) + "&d_obsConstr=" + removeAcento(document.getElementById('txt_dado_construtora').value) + "&tipo=" + tipo + "&versao=2.0&env_em=" + ev_email + "&segur=" + crypt_segur + "&t=" + Math.random(), false);
                ajax3.onreadystatechange = function () {
                    if (ajax3.readyState == 4) {
                        if (ajax3.status == 200 || ajax3.status == 0) {

                            var resposta_total = ajax3.responseText;
                            alert("Alterações realizadas com sucesso!")

                            reload_page_empree();

                        } else {
                            alert("Problemas com sua conexão internet. Erro: 0137");
                        }
                    }
                }
                ajax3.send();
            }
        }

    }

    function apagar_fot_vid_aud_tex(q_cam) {
        var q_cam;
        if (e_construtora == 0) {
            var trash = document.querySelector('.all_trash');

            var res = confirm('Tem certeza que deseja excluir este arquivo?');
            if (res == true) {
                if (datadiff(Date.now(), d_min) > 0 || datadiff(Date.now(), d_max) < 0) {
                    alert("A exclusão deste arquivo só pode ser realizada entre o período " + dateToEN(d_min) + ' a ' + dateToEN(d_max) + '!')
                } else if (nivel_manut == 2 && qt_docs == 1) {
                    alert('Não é possível a exclusão, pois esta manutenção precisa de pelo menos 1 documento comprovatório anexado!')
                } else {
                    var deletar_arq = "S";
                    if (nivel_manut == 1 && qt_docs == 1) {
                        prosseguir = confirm('É importante anexar um documento que comprove esta manutenção. Tem certeza que deseja prosseguir sem anexar um comprovante?')
                        if (prosseguir == false) {
                            deletar_arq = "N"
                        }
                    }
                    if (deletar_arq == "S") {

                        var verific1 = 3 * parseInt(id_empree) + 3 * parseInt(id_cliente)
                        var verific2 = Math.abs(6 * parseInt(id_empree) - 3 * parseInt(id_cliente))
                        var verific3 = Math.abs(3 * parseInt(id_empree) + 2 * parseInt(id_cliente))
                        var verif_fim = verific1 + "S" + verific2 + "C" + verific3

                        var ajax3 = new XMLHttpRequest();
                        ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_excluir_arq.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&e_const=" + e_construtora + "&seg=" + verif_fim + "&cam=" + q_cam + "&versao=2.0")
                        ajax3.onreadystatechange = function () {
                            if (ajax3.readyState == 4) {
                                if (ajax3.status == 200 || ajax3.status == 0) {

                                    var resposta_total = ajax3.responseText;
                                    reload_page_even();

                                } else {
                                    alert("Problemas com sua conexão internet. Erro: 0147");
                                }
                            }
                        }
                        ajax3.send();

                    }

                }
            }
        } else if (e_construtora == 1) {
            var res = confirm('Tem certeza que deseja excluir este arquivo?');
            if (res == true) {
                if (datadiff(Date.now(), d_min) > 0 || datadiff(Date.now(), d_max) < 0) {
                    alert("A exclusão deste arquivo só pode ser realizada no período de " + dateToEN(d_min) + ' a ' + dateToEN(d_max) + '!')
                } else {

                    var verific1 = 3 * parseInt(id_empree) + 3 * parseInt(id_cliente)
                    var verific2 = Math.abs(6 * parseInt(id_empree) - 3 * parseInt(id_cliente))
                    var verific3 = Math.abs(3 * parseInt(id_empree) + 2 * parseInt(id_cliente))
                    var verif_fim = verific1 + "S" + verific2 + "C" + verific3

                    var ajax3 = new XMLHttpRequest();
                    ajax3.open("GET", "https://www.sigmacivil.com.br/app_sc/consult_excluir_arq.asp?l=" + login + "&s=" + senha + "&e=" + id_empree + "&c=" + id_cliente + "&e_const=" + e_construtora + "&seg=" + verif_fim + "&cam=" + q_cam + "&versao=2.0")
                    ajax3.onreadystatechange = function () {
                        if (ajax3.readyState == 4) {
                            if (ajax3.status == 200 || ajax3.status == 0) {

                                var resposta_total = ajax3.responseText;
                                // alert("Arquivo excluido com sucesso!")
                                reload_page_even();

                            } else {
                                alert("Problemas com sua conexão internet. Erro: 0157");
                            }
                        }
                    }
                    ajax3.send();
                }
            }
        }
    }

    function ChangeColor(input) {
        input.style.borderColor = "green";
    }

    function BackColor(input) {
        input.style.borderColor = "#dddddd";
    }

    function ChangeColorBlue(input) {
        input.style.borderColor = "#4793d0";
    }

    function BackColorBlue(input) {
        input.style.borderColor = "#dddddd";
    }

    function removeAcento(text) {
        // text = text.toLowerCase();

        // a
        text = text.replace(/Á/g, '@*L1@A')
        text = text.replace(/À/g, '@*L2@A')
        text = text.replace(/Ã/g, '@*L3@A')
        text = text.replace(/Â/g, '@*L4@A')

        text = text.replace(/á/g, '@*L1@a')
        text = text.replace(/à/g, '@*L2@a')
        text = text.replace(/ã/g, '@*L3@a')
        text = text.replace(/â/g, '@*L4@a')

        // e
        text = text.replace(/É/g, '@*L1@E')
        text = text.replace(/È/g, '@*L2@E')
        text = text.replace(/Ê/g, '@*L4@E')

        text = text.replace(/é/g, '@*L1@e')
        text = text.replace(/è/g, '@*L2@e')
        text = text.replace(/ê/g, '@*L4@e')

        // i
        text = text.replace(/Í/g, '@*L1@I')
        text = text.replace(/Ì/g, '@*L2@I')
        text = text.replace(/Î/g, '@*L4@I')

        text = text.replace(/í/g, '@*L1@i')
        text = text.replace(/ì/g, '@*L2@i')
        text = text.replace(/î/g, '@*L4@i')

        // o
        text = text.replace(/Ó/g, '@*L1@O')
        text = text.replace(/Ò/g, '@*L2@O')
        text = text.replace(/Õ/g, '@*L3@O')
        text = text.replace(/Ô/g, '@*L4@O')

        text = text.replace(/ó/g, '@*L1@o')
        text = text.replace(/ò/g, '@*L2@o')
        text = text.replace(/õ/g, '@*L3@o')
        text = text.replace(/ô/g, '@*L4@o')

        // u
        text = text.replace(/Ú/g, '@*L1@U')
        text = text.replace(/Ù/g, '@*L2@U')
        text = text.replace(/Û/g, '@*L4@U')

        text = text.replace(/ú/g, '@*L1@u')
        text = text.replace(/ù/g, '@*L2@u')
        text = text.replace(/û/g, '@*L4@u')

        // ç
        text = text.replace(/Ç/g, '@*L0@C')

        text = text.replace(/ç/g, '@*L0@c')

        return text;
    }

    function onFocus(element) {
        alert(element)
    }

</script>